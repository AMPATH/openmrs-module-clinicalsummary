<?xml version="1.0"?>
<clinicalSummary>
	<moduleVersion>$!{moduleVersion}</moduleVersion>
	<templateRevision>$!{templateRevision}</templateRevision>
	<templateName>$!{templateName}</templateName>
	
	<identifiers>
	<!-- pull the first identifier from all active identifier -->
    #foreach(${id} in $!{patient.getActiveIdentifiers()})
        #if (${velocityCount} == 1)
           <id>$!{id}</id>
        #else
            <alternateId>$!{id}</alternateId>
        #end
    #end
    </identifiers>
    
    #set($parameters = {"evaluated.concept" : "RETURN VISIT DATE", "included.encounter.types" : ["ANCINITIAL", "ANCRETURN"]})
    #set($returnVisit = $!{functions.eval($patient, "Datetime Latest Obs", $parameters)})
    <returnVisit>$!{functions.formatDate($!{returnVisit.toDatetime()})}</returnVisit>
    
    <lastEncounter>
    	#set($parameters = {"evaluated.encounter" : "encounter.location", "included.encounter.types" : ["ANCINITIAL", "ANCRETURN"]})
    	#set($result = $!{functions.eval($patient, "Complete Encounter", $parameters)})
    	#set($latestEncounterLocation = $!{result.latest()})
        <dateTime>
    		$!{functions.formatDate($!{latestEncounterLocation.getResultDate()})}
        </dateTime>
        <location>
        	$!{latestEncounterLocation.toString()}
        </location>
        <provider>
    		#set($parameters = {"evaluated.encounter" : "encounter.provider", "included.encounter.types" : ["ANCINITIAL", "ANCRETURN"]})
    		#set($result = $!{functions.eval($patient, "Complete Encounter", $parameters)})
    		#set($latestEncounterProvider = $!{result.latest()})
        	$!{latestEncounterProvider.toString()}
        </provider>
    	#set($parameters = {"evaluated.encounter" : "encounter.creator", "included.encounter.types" : ["ANCINITIAL", "ANCRETURN"]})
    	#set($result = $!{functions.eval($patient, "Complete Encounter", $parameters)})
    	#set($latestEncounterCreator = $!{result.latest()})
        <createdDate>
        	$!{functions.formatDate($!{latestEncounterCreator.getResultDate()})}
        </createdDate>
        <creator>
        	$!{latestEncounterCreator.toString()}
        </creator>
    </lastEncounter>
    <demographic>
	    <name>
	        $!{patient.getGivenName()}
	        $!{patient.getMiddleName()}
	        $!{patient.getFamilyName()}
	    </name>
    	<gender>$!{patient.getGender()}</gender>
	    #set($birthdateEstimated = $!{patient.getBirthdateEstimated()})
	    #set($age = $!{patient.getAge()})
	    #set($birth = $!{patient.getBirthdate()})
	    <birthdate>
	    	<estimated>$!{birthdateEstimated}</estimated>
	    	<age>$!{age}</age>
	        <dob>$!{functions.formatDate(${birth})}</dob>
	    </birthdate>
	    <address>
	    	#set($address = $!{patient.getPersonAddress()})
	    	$!{address.getRegion()} 
	    </address>
	    <education>
			#set($map = {"evaluated.concept" : "HIGHEST EDUCATION"})
	    	#set($education = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    	$!{education}
	    </education>
	    <civil-status>
			#set($map = {"evaluated.concept" : "CIVIL STATUS"})
	    	#set($civilStatus = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    	$!{civilStatus}
	    </civil-status>
	    <occupation>
			#set($map = {"evaluated.concept" : "OCCUPATION"})
	    	#set($occupation = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    	$!{occupation}
	    </occupation>
    </demographic>
    
    <pregnancy-history>
    	<gravida>
			#set($map = {"evaluated.concept" : "GRAVIDA"})
	    	#set($gravida = $!{functions.eval($patient, "Initial Single Numeric", $map)})
	    	$!{functions.makeInteger($!{gravida.toNumber()})}
	    </gravida>
    	<parity>
			#set($map = {"evaluated.concept" : "PARITY"})
	    	#set($parity = $!{functions.eval($patient, "Initial Single Numeric", $map)})
	    	$!{functions.makeInteger($!{parity.toNumber()})}
	    </parity>
    	<lmp>
			#set($map = {"evaluated.concept" : "LAST MENSTRUAL PERIOD DATE"})
	    	#set($lmp = $!{functions.eval($patient, "Initial Single Datetime", $map)})
	    	$!{functions.formatDate(${lmp.toDatetime()})}
    	</lmp>
    	<edd>
			#set($map = {"evaluated.concept" : "ESTIMATED DATE OF CONFINEMENT"})
	    	#set($edd = $!{functions.eval($patient, "Initial Single Datetime", $map)})
	    	$!{functions.formatDate(${edd.toDatetime()})}
    	</edd>
    	<usg>
			#set($map = {"evaluated.concept" : "OBSTETRIC ULTRASOUND DONE"})
	    	#set($usg = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    	$!{usg}
    	</usg>
    </pregnancy-history>
    
    <partner>
    	<name>$!{patient.getAttribute("Partner Name")}</name>
    	<age>$!{patient.getAttribute("Partner Age")}</age>
    	<occupation>
			#set($map = {"evaluated.concept" : "PARTNER'S OCCUPATION"})
	    	#set($occupation = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    	$!{occupation}
    	</occupation>
    </partner>
    
    <information>
    	<insurance>
			#set($map = {"evaluated.concept" : "HEALTH INSURANCE"})
	    	#set($insurance = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    	$!{insurance}
    	</insurance>
    	<transport>
			#set($map = {"evaluated.concept" : "EMERGENCY TRANSPORTATION PLAN"})
	    	#set($transport = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    	$!{transport}
    	</transport>
    	<barriers>
    		#set($map = {"evaluated.concept" : "TYPES OF BARRIER TO PROPER HEALTH CARE"})
	    	#set($barriers = $!{functions.eval($patient, "Latest Multi Coded", $map)})
	    	$!{barriers}
	    </barriers>
    	<net>
    		#set($map = {"evaluated.concept" : "RECIEVED ANTENATAL CARE SERVICE THIS VISIT",
						 "included.coded.values" : "INSECTICIDE-TREATED BEDNET"})
	    	#set($net = $!{functions.eval($patient, "Latest Multi Coded", $map)})
	    	$!{net}
	    </net>
    </information>
    
    <medical-history>
	    <hiv>
	    	<tested>
				#set($map = {"evaluated.concept" : "HIV TESTED THIS VISIT"})
	    		#set($tested = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    		<value>$!{tested}</value>
	    		<datetime>$!{functions.formatDate($!{tested.getResultDate()})}</datetime>
	    	</tested>
	    	<qualitative>
				#set($map = {"evaluated.concept" : "HIV RAPID TEST, QUALITATIVE"})
	    		#set($qualitative = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    		$!{qualitative}
	    	</qualitative>
	    </hiv>
    	<stds>
    		#set($map = {"evaluated.concept" : "REVIEW OF MEDICAL HISTORY",
						 "included.coded.values" : "CERVICITIS;PELVIC INFLAMMATORY DISEASE;GENITAL SORES;WARTS, GENITAL;
						 						   GONORRHEA;SYPHILIS;HERPES SIMPLEX, NOS;CHLAMYDIA TRACHOMATIS;TRICHOMONAS"})
	    	#set($stds = $!{functions.eval($patient, "Initial Multi Coded", $map)})
	    	$!{stds}
	    </stds>
    	<depression>
			#set($map = {"evaluated.concept" : "HISTORY OF POSTPARTUM DEPRESSION OR MENTAL HEALTH PROBLEM"})
	    	#set($depression = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    	$!{depression}
    	</depression>
    	<others>
    		#set($map = {"evaluated.concept" : "REVIEW OF MEDICAL HISTORY",
						 "included.coded.values" : "THYROID NODULE;DIABETES MELLITUS;HYPERTENSION;ICTERIC SCLERA;
												   HEART DISEASE;ASTHMA;ABNORMAL PAP SMEAR;THROMBUS;URINARY TRACT INFECTION;
												   SEIZURE;PROBLEMS WITH ANESTHESIA;HISTORY OF BLOOD TRANSFUSION;
												   HISTORY OF MULTIPLE BIRTHS IN MATERNAL FAMILY;
												   CONGENITAL ANOMALY IN NEWBORN;ANEMIA;BREAST DISORDERS;HISTORY OF HOSPITALIZATION; 
												   ALLERGY REACTION FROM DRUGS"})
	    	#set($others = $!{functions.eval($patient, "Initial Multi Coded", $map)})
	    	$!{others}
    	</others>
    </medical-history>
    
    <current-medications>
    	<medications>
			#set($map = {"included.evaluated.concepts" : "MEDICATION ADDED"})
			#set($medicationsAdded = $!{functions.eval($patient, "Historical Multi Concept", $map)})
			#foreach (${element} in $!{medicationsAdded.get(0)})
				#if (${velocityCount} > 1)
					<element>$!{element}</element>
				#end
			#end
			#set($map = {"evaluated.concept" : "RECIEVED ANTENATAL CARE SERVICE THIS VISIT",
						 "included.coded.values" : "IRON SUPPLEMENT;COTRIMAZOLE;FOLIC ACID"})
	    	#set($others = $!{functions.eval($patient, "Latest Multi Coded", $map)})
			#foreach (${other} in $!{others})
				<element>$!{other}</element>
			#end
    	</medications>
    	<tt>
    		<completed>
	    		#set($map = {"evaluated.concept" : "TETANUS BOOSTER COMPLETED"})
		    	#set($ttCompleted = $!{functions.eval($patient, "Latest Single Coded", $map)})
		    	$!{ttCompleted}
		    </completed>
			#set($map = {"included.evaluated.concepts" : "TETANUS BOOSTER;
						 								  QUANTITY"})
			#set($tt = $!{functions.eval($patient, "Historical Multi Concept", $map)})
			#set(${latestTetanusBooster} = $!{tt.get(0)})
	    	#set($total = $!{latestTetanusBooster.get(2).toNumber()})
	    	#set(${given} = "RECEIVED")
	    	#if ($!{latestTetanusBooster.get(1)} == '1')
	    		#set($total = $total + 1)
	    		#set(${received} = "RECEIVED")
	    	#end
    		<received>
    			$!{received}
	    	</received>
	    	<total>
	    		$!{functions.makeInteger($!{total})}
	    	</total>
    	</tt>
    	<ipt1>
    		#set($map = {"evaluated.concept" : "RECIEVED ANTENATAL CARE SERVICE THIS VISIT",
						 "included.coded.values" : "INTERMITTENT PREVENTIVE TREATMENT 1"})
	    	#set($ipt1 = $!{functions.eval($patient, "Latest Multi Coded", $map)})
	    	$!{ipt1}
	    </ipt1>
    	<ipt2>
    		#set($map = {"evaluated.concept" : "RECIEVED ANTENATAL CARE SERVICE THIS VISIT",
						 "included.coded.values" : "INTERMITTENT PREVENTIVE TREATMENT 2"})
	    	#set($ipt2 = $!{functions.eval($patient, "Latest Multi Coded", $map)})
	    	$!{ipt2}
	    </ipt2>
    	<anti-d>
			#set($map = {"evaluated.concept" : "ANTI-D RH IGG GIVEN AT 28 GESTATION WEEKS "})
	    	#set($anti = $!{functions.eval($patient, "Latest Single Coded", $map)})
	    	$!{anti}
    	</anti-d>
    	<contraceptions>
    		#set($map = {"evaluated.concept" : "METHOD OF FAMILY PLANNING"})
	    	#set($contraceptions = $!{functions.eval($patient, "Initial Multi Coded", $map)})
	    	$!{contraceptions}
    	</contraceptions>
    	<substances>
    		#set($map = {"evaluated.concept" : "PRESENCE OF SUBSTANCE USE"})
	    	#set($substances = $!{functions.eval($patient, "Initial Multi Coded", $map)})
	    	$!{substances}
    	</substances>
    </current-medications>
    
    <preferences>
    	<delivery-site>
    		<health-facility>
				#set($map = {"evaluated.concept" : "DELIVERY PLACE, BIRTH PLAN"})
		    	#set($facility = $!{functions.eval($patient, "Latest Single Coded", $map)})
		    	$!{facility}
	    	</health-facility>
    		<location>
				#set($map = {"evaluated.concept" : "MOTHER'S PREFERRED DELIVERY PLACE, BIRTH PLAN"})
		    	#set($location = $!{functions.eval($patient, "Latest Single Coded", $map)})
		    	$!{location}
    		</location>
    		<reasons>
				#set($map = {"evaluated.concept" : "REASON FOR NOT DELIVERING AT HEALTH FACILITY"})
		    	#set($reason = $!{functions.eval($patient, "Latest Multi Coded", $map)})
		    	$!{reason}
    		</reasons>
    	</delivery-site>
    	<delivery-mode>
			#set($map = {"evaluated.concept" : "PREFERRED MODE OF DELIVERY"})
		    #set($mode = $!{functions.eval($patient, "Latest Single Coded", $map)})
		    $!{mode}
    	</delivery-mode>
    	<infant-feeding>
			#set($map = {"evaluated.concept" : "MOTHER'S PREFERRED FEEDING METHOD, BIRTH PLAN"})
		    #set($feeding = $!{functions.eval($patient, "Latest Single Coded", $map)})
		    $!{feeding}
    	</infant-feeding>
    </preferences>
    
    <previous-pregnancies>
    	<header>
    		<element></element>
    		<element>DOD</element>
    		<element>Gestation at Delivery / Miscarriage</element>
    		<element>Outcomes</element>
    		<element>Location</element>
    		<element>Length of Labors</element>
    		<element>Method of Delivery</element>
    		<element>Gender</element>
    		<element>Weight</element>
    		<element>Complications</element>
    	</header>
		#set($map = {"evaluated.concept" : "PAST OBSTERICAL HISTORY",
					 "included.evaluated.concepts" : "DATE OF CONFINEMENT;GESTATION MONTH AT DELIVERY OR MISCARRIAGE;
					 								  PREGNANCY OUTCOME;PLACE OF DELIVERY;LENGTH OF LABOR IN HOURS;
					 								  METHOD OF DELIVERY;GENDER OF THE CHILD;BIRTH WEIGHT;
					 								  MATERNAL, FETAL, OR CHILD COMPLICATIONS, FREETEXT"})
		#set($previousPregnancies = $!{functions.eval($patient, "Initial Multi Concept", $map)})
		#foreach (${previousPregnancy} in $!{previousPregnancies})
		<previous-pregnancy>
			#foreach (${element} in $!{previousPregnancy})
				#if(${velocityCount} == 1 || ${velocityCount} == 2)
					<element>$!{functions.formatDate(${element.toDatetime()})}</element>
				#elseif (${velocityCount} == 3 || ${velocityCount} == 6)
					<element>$!{functions.makeInteger(${element.toNumber()})}</element>
				#else
					<element>$!{element}</element>
				#end
			#end
		</previous-pregnancy>
		#end
    </previous-pregnancies>

	<present-pregnancies>
    	<header>
    		<element>Date</element>
    		<element>N/V</element>
    		<element>H/A</element>
    		<element>Swelling</element>
    		<element>Fever</element>
    		<element>Dysuria</element>
    		<element>Genital Ulcers</element>
    		<element>Cough</element>
    		<element>Night Sweats</element>
    		<element>Vaginal Discharge</element>
    		<element>Vaginal Bleeding</element>
    		<element>Uterine Contraction</element>
    		<element>Foet Mvt</element>
    	</header>
		#set($map = {"evaluated.concept" : "REVIEW OF SYSTEMS, OBSTETRICAL",
					 "included.coded.values" : "NAUSEA AND VOMITING;HEADACHE;EDEMA, HANDS OR FACE;FEVER;
					 						    DYSURIA;GENITAL SORES;COUGH;NIGHT SWEATS;
					 						    VAGINAL DISCHARGE;VAGINAL BLEEDING;UTERINE CONTRACTION"})
		#set($reviewSystems = $!{functions.eval($patient, "Historical Multi Coded", $map)})
		#set($map = {"evaluated.concept" : "FOETAL MOVEMENT"})
		#set($foetalMovement = $!{functions.eval($patient, "Historical Single Coded", $map)})
		#foreach (${reviewSystem} in $!{reviewSystems})
		<present-pregnancy>
			#set($encounterCounter = $velocityCount - 1)
			#foreach (${element} in $!{reviewSystem})
				#if(${velocityCount} == 1)
					<element>$!{functions.formatDate(${element.getResultDate()})}</element>
				#else
					<element>$!{element}</element>
				#end
			#end
			<element>$!{foetalMovement.get($encounterCounter)}</element>
		</present-pregnancy>
		#end
	</present-pregnancies>

	<physical-exams>
		<header>
			<element>Date</element>
			<element>Temp</element>
			<element>HR</element>
			<element>BP</element>
			<element>WT (kg)</element>
			<element>HT (cm)</element>
			<element>Gen</element>
			<element>Head Neck</element>
			<element>CVS</element>
			<element>Resp</element>
			<element>Gyn</element>
			<element>Breast</element>
			<element>Fundal HT (cm)</element>
			<element>Fetal HR</element>
			<element>Presentation</element>
		</header>
		#set($map = {"included.evaluated.concepts" : "TEMPERATURE (C);PULSE;SYSTOLIC BLOOD PRESSURE;DIASTOLIC BLOOD PRESSURE;WEIGHT (KG);
					 								  HEIGHT (CM);GENERAL EXAM FINDINGS;HEAD OR NECK EXAM FINDINGS;CARDIAC EXAM FINDINGS;
					 								  RESPIRATORY EXAM FINDINGS;UROGENITAL EXAM FINDINGS;BREAST EXAM FINDINGS;FUNDAL HEIGHT;
					 								  FOETAL HEART RATE;FOETAL PRESENTATION"})
		#set($physicalExams = $!{functions.eval($patient, "Historical Multi Concept", $map)})
		#foreach (${physicalExam} in $!{physicalExams})
		<physical-exam>
			#foreach (${element} in $!{physicalExam})
				#if(${velocityCount} == 1)
					<element>$!{functions.formatDate($!{element.getResultDate()})}</element>
				#elseif(${velocityCount} == 4)
					<element>$!{functions.makeInteger($!{element.toNumber()})} / 
				#elseif(${velocityCount} == 5)
					$!{functions.makeInteger($!{element.toNumber()})}</element>
				#elseif(${velocityCount} == 3 || ${velocityCount} == 15)
					<element>$!{functions.makeInteger($!{element.toNumber()})}</element>
				#else
					<element>$!{element}</element>
				#end
			#end
		</physical-exam>
		#end
	</physical-exams>

	<lab-tests>
		<blood-group>
			#set($map = {"evaluated.concept" : "BLOOD TYPING"})
	    	#set($bloodTyping = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    	<value>$!{bloodTyping}</value>
	    	<datetime>$!{functions.formatDate($!{bloodTyping.getResultDate()})}</datetime>
		</blood-group>
		<rh>
			#set($map = {"evaluated.concept" : "RHESUS FACTOR"})
	    	#set($rhesus = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    	<value>$!{rhesus}</value>
	    	<datetime>$!{functions.formatDate($!{rhesus.getResultDate()})}</datetime>
		</rh>
		<antibody>
			#set($map = {"evaluated.concept" : "ANTIBODY SCREEN"})
	    	#set($antibody = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    	<value>$!{antibody}</value>
	    	<datetime>$!{functions.formatDate($!{antibody.getResultDate()})}</datetime>
		</antibody>
		<us>
			#set($map = {"evaluated.concept" : "OBSTETRIC ULTRASOUND DONE"})
	    	#set($us = $!{functions.eval($patient, "Initial Single Coded", $map)})
	    	<value>$!{us}</value>
	    	<datetime>$!{functions.formatDate($!{us.getResultDate()})}</datetime>
		</us>
		<flowsheets>
			<header>
				<element>HGB</element>
				<element>BS</element>
				<element>PBS</element>
				<element>RPR</element>
				<element>Prot</element>
				<element>Gluc</element>
				<element>Leuc</element>
			</header>
				#set($map = {"included.evaluated.concepts" : "HEMOGLOBIN;SERUM GLUCOSE;MALARIAL SMEAR;SERUM GLUCOSE;
							 								  PRESENCE OF PROTEIN;PRESENCE OF SUGAR;PRESENCE OF LEUKOCYTES"})
				#set($flowsheets = $!{functions.eval($patient, "Historical Multi Concept", $map)})
				#foreach (${flowsheet} in $!{flowsheets})
				<flowsheet>
					#foreach (${element} in $!{flowsheet})
						#if(${velocityCount} > 1)
						<element>
							<value>$!{element}</value>
							<datetime>$!{functions.formatDate($!{element.getResultDate()})}</datetime>
						</element>
						#end
					#end
				</flowsheet>
				#end
		</flowsheets>
	</lab-tests>

	<education-counselings>
		<header>
			<element>Date</element>
			<element>Weight Gain / Nutrition</element>
			<element>Sex Education</element>
			<element>Contraception</element>
			<element>Medication Use</element>
			<element>Foetal Movement</element>
			<element>Signs of Labor</element>
			<element>Delivery Mode</element>
			<element>Neonatal Care</element>
			<element>Post Part Care</element>
			<element>Work</element>
			<element>PROM/APH</element>
			<element>Infant Feeding</element>
		</header>
		#set($map = {"evaluated.concept" : "PATIENT EDUCATION RECEIVED THIS VISIT",
					 "included.coded.values" : "NUTRITIONAL SUPPORT;SEX EDUCATION;CONTRACEPTION;MEDICATION USE COUNSELLING;
					 						   FOETAL MOVEMENT;SIGNS OF LABOR;METHOD OF DELIVERY;NEONATAL CARE;
					 						   POSTPARTUM;WORK;PREMATURE RUPTURE OF MEMBRANES OR ANTEPARTUM HEMORRHAGE;
					 						   INFANT FEEDING COUNSELING"})
		#set($educationCounselings = $!{functions.eval($patient, "Historical Multi Coded", $map)})
		#foreach (${educationCounseling} in $!{educationCounselings})
		<education-counseling>
			#foreach (${element} in $!{educationCounseling})
				#if(${velocityCount} == 1)
					<element>$!{functions.formatDate($!{element.getResultDate()})}</element>
				#else
					<element>$!{element}</element>
				#end
			#end
		</education-counseling>
		#end
    </education-counselings>
    
    <referrals>
		#set($map = {"evaluated.concept" : "REFERRALS ORDERED"})
		#set($referrals = $!{functions.eval($patient, "Latest Single Coded", $map)})
		<value>$!{referrals}</value>
		<datetime>$!{functions.formatDate($!{referrals.getResultDate()})}</datetime>
    </referrals>
</clinicalSummary>