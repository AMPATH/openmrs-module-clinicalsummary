<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqldiff PUBLIC "-//OpenMRS//DTD OpenMRS SQL Diff Config 1.0//EN" "http://resources.openmrs.org/doctype/sqldiff-1.0.dtd">

<sqldiff version="1.0">
	<help>
		USE:
		The diffs are ordered by datamodel version number.
		The script can be run in a top down fashion and is
		expected to not failor overwrite old data

		EXPECT:
		- "use business-database-name;" was called prior to
		calling this script
	</help>

	<diff>
		<version>1.0.0</version>
		<author>Ben Wolfe</author>
		<date>Mar 16th 2007</date>
		<description>
			Create the clinical summary table
		</description>
		<sql>
			CREATE TABLE IF NOT EXISTS clinical_summary (
			clinical_summary_id int(11) NOT NULL auto_increment,
			name varchar(255) NOT NULL,
			description text NOT NULL,
			summary text NOT NULL,
			xslt text NOT NULL,
			preferred int(1) NOT NULL default '0',
			creator int(11) NOT NULL default '0',
			date_created datetime NOT NULL default '0000-00-00 00:00:00',
			changed_by int(11) default NULL,
			date_changed datetime default '0000-00-00 00:00:00',
			PRIMARY KEY (clinical_summary_id),
			KEY clinical_summary_creator (creator),
			KEY clinical_summary_changer (changed_by),
			CONSTRAINT clinical_summary_creator FOREIGN KEY (creator) REFERENCES users (user_id),
			CONSTRAINT user_who_changed_clinical_summary FOREIGN KEY (changed_by) REFERENCES users (user_id)
			) ;
		</sql>
	</diff>

	<diff>
		<version>1.1.0</version>
		<author>Ben Wolfe</author>
		<date>Mar 19th 2007</date>
		<description>
			Create an example clinical summary
		</description>
		<sql>
			<![CDATA[
			INSERT INTO clinical_summary VALUES ('1', 'Basic Clinical Summary', 'Defines a basic clinical summary based mostly on concepts in the base concept dataset.', '<?xml version=\"1.0\"?>\r\n<clinicalSummaryList>\r\n\r\n#foreach($patientId in $patientSet.patientIds)\r\n$!{fn.setPatientId($patientId)}\r\n<clinicalSummary>\r\n	<id>$!{fn.getPatientAttr(\'PatientIdentifier\', \'identifier\')}</id>\r\n	<name>\r\n		$!{fn.getPatientAttr(\'PatientName\', \'givenName\')} \r\n		$!{fn.getPatientAttr(\'PatientName\', \'middleName\')} \r\n		$!{fn.getPatientAttr(\'PatientName\', \'familyName\')}\r\n	</name>\r\n	#set($age = $!{fn.getAge($fn.getPatientAttr(\'Patient\', \'birthdate\'))})\r\n	<age units=\"${age.get(1)}\">\r\n		${age.get(0)}\r\n	</age>\r\n	<firstEncounterDate>\r\n		$!{fn.formatDate(\'dd-MMM-yyyy\', ${fn.getFirstEncounter(\'\').getEncounterDatetime()})}\r\n	</firstEncounterDate>\r\n	<healthCenter>${fn.getValueAsString($!{fn.getPatientAttr(\'Patient\', \'healthCenter\')})}</healthCenter>\r\n	<whoStage>${fn.getValueAsString(${fn.getLastObs(\'5356\')})}</whoStage>\r\n	<perfectAdherence>\r\n		#set($obsValues = $fn.getObsTimeframe(\'1164\', 12))\r\n		#if (${obsValues.size()} < 1)\r\n			unknown\r\n		#else\r\n			#set($all = true)\r\n			#foreach($val in $obsValues)\r\n				#if (!(${val.getConceptId()} == 1163))#set($all = false)#end\r\n			#end\r\n			#if ($all == true)\r\n				true\r\n			#else\r\n				false\r\n			#end\r\n		#end\r\n	</perfectAdherence>\r\n	<problemList>\r\n		<!-- Make a list of all PROBLEM ADDED without a subsequent matching PROBLEM RESOLVED -->\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getIntersectedObs(\'6042\', \'6097\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<problem date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0).getName()})}\r\n			</problem>\r\n		#end\r\n	</problemList>\r\n	<flowsheet>\r\n  	<!--\r\n  		List all known values for\r\n  			WEIGHT (KG),\r\n  			HGB (concept HEMOGLOBIN),\r\n  			SAO2 (concept BLOOD OXYGEN SATURATION),\r\n  			CD4 (CD4, BY FACS),\r\n  			SGPT\r\n  		All dates should be in MM-DD-YYYY format\r\n  		For CD4: if CD4% exists on same day, repeat as CD4 (%), e.g. <value date=\"...\">252 (16%)</value>\r\n  	-->\r\n	<results name=\"WEIGHT (KG)\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'5089\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	<results name=\"HGB\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'21\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	<results name=\"SA02\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'5092\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	<results name=\"CD4\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'5497\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	<results name=\"SGPT\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'654\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	</flowsheet>\r\n\r\n	#set($arr = [\'obsDatetime\'])\r\n	#set($obsValues = $fn.getLastNObsWithValues(-1, \'12\', $arr))\r\n	#foreach($vals in $obsValues)\r\n		#if($velocityCount == 1)<cxr date=\"${fn.formatDate(\'short\', ${vals.get(1)})}\">#end\r\n			${fn.getValueAsString(${vals.get(0)})}\r\n			#if($velocityCount > 1) , #end\r\n		#if($velocityCount == ${obsValues.size()})</cxr>#end\r\n	#end\r\n\r\n</clinicalSummary>\r\n#end <!-- ending patient loop -->\r\n\r\n</clinicalSummaryList>', 'xslt string', '1', '1', '2007-03-16 14:20:22', '1', '2007-03-19 10:12:34');
			]]>
		</sql>
	</diff>


	<diff>
		<version>1.1.1</version>
		<author>Ben Wolfe</author>
		<date>Mar 21st 2007</date>
		<description>
			Updating the default summary to include meds
		</description>
		<sql>
			<![CDATA[
				INSERT INTO clinical_summary VALUES ('2', 'AMPATH Clinical Summary', 'Defines a clinical summary very similar to the basic summary except with the addition of the AMPATH medication list.', '<?xml version=\"1.0\"?>\r\n<clinicalSummaryList>\r\n\r\n#foreach($patientId in $patientSet.patientIds)\r\n$!{fn.setPatientId($patientId)}\r\n<clinicalSummary>\r\n	<id>$!{fn.getPatientAttr(\'PatientIdentifier\', \'identifier\')}</id>\r\n	<name>\r\n		$!{fn.getPatientAttr(\'PatientName\', \'givenName\')} \r\n		$!{fn.getPatientAttr(\'PatientName\', \'middleName\')} \r\n		$!{fn.getPatientAttr(\'PatientName\', \'familyName\')}\r\n	</name>\r\n	#set($age = $!{fn.getAge($fn.getPatientAttr(\'Patient\', \'birthdate\'))})\r\n	<age units=\"${age.get(1)}\">\r\n		${age.get(0)}\r\n	</age>\r\n	<firstEncounterDate>\r\n		$!{fn.formatDate(\'dd-MMM-yyyy\', ${fn.getFirstEncounter(\'\').getEncounterDatetime()})}\r\n	</firstEncounterDate>\r\n	<healthCenter>${fn.getValueAsString($!{fn.getPatientAttr(\'Patient\', \'healthCenter\')})}</healthCenter>\r\n	<whoStage>${fn.getValueAsString(${fn.getLastObs(\'5356\')})}</whoStage>\r\n	<perfectAdherence>\r\n		#set($obsValues = $fn.getObsTimeframe(\'1164\', 12))\r\n		#if (${obsValues.size()} < 1)\r\n			unknown\r\n		#else\r\n			#set($all = true)\r\n			#foreach($val in $obsValues)\r\n				#if (!(${val.getConceptId()} == 1163))#set($all = false)#end\r\n			#end\r\n			#if ($all == true)\r\n				true\r\n			#else\r\n				false\r\n			#end\r\n		#end\r\n	</perfectAdherence>\r\n	<problemList>\r\n		<!-- Make a list of all PROBLEM ADDED without a subsequent matching PROBLEM RESOLVED -->\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getIntersectedObs(\'6042\', \'6097\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<problem date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0).getName()})}\r\n			</problem>\r\n		#end\r\n	</problemList>\r\n	<flowsheet>\r\n  	<!--\r\n  		List all known values for\r\n  			WEIGHT (KG),\r\n  			HGB (concept HEMOGLOBIN),\r\n  			SAO2 (concept BLOOD OXYGEN SATURATION),\r\n  			CD4 (CD4, BY FACS),\r\n  			SGPT\r\n  		All dates should be in MM-DD-YYYY format\r\n  		For CD4: if CD4% exists on same day, repeat as CD4 (%), e.g. <value date=\"...\">252 (16%)</value>\r\n  	-->\r\n	<results name=\"WEIGHT (KG)\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'5089\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	<results name=\"HGB\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'21\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	<results name=\"SA02\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'5092\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	<results name=\"CD4\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'5497\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	<results name=\"SGPT\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'654\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	</flowsheet>\r\n\r\n	#set($arr = [\'obsDatetime\'])\r\n	#set($obsValues = $fn.getLastNObsWithValues(-1, \'12\', $arr))\r\n	#foreach($vals in $obsValues)\r\n		#if($velocityCount == 1)<cxr date=\"${fn.formatDate(\'short\', ${vals.get(1)})}\">#end\r\n			${fn.getValueAsString(${vals.get(0)})}\r\n			#if($velocityCount > 1) , #end\r\n		#if($velocityCount == ${obsValues.size()})</cxr>#end\r\n	#end\r\n\r\n	#set($medValues = ${fn.getAmpathActiveMedications()})\r\n	#foreach($vals in $medValues)\r\n		#if($velocityCount == 1)<medications>#end\r\n		<medication date=\"${fn.formatDate(\'short\', ${vals.get(1)})}\">\r\n			${fn.getValueAsString(${vals.get(0)})}\r\n		</medication>\r\n		#if($velocityCount == ${medValues.size()})</medications>#end\r\n	#end\r\n\r\n</clinicalSummary>\r\n#end <!-- ending patient loop -->\r\n\r\n</clinicalSummaryList>', 'xslt string', '0', '1', '2007-03-20 14:20:22', '1', '2007-03-21 10:12:34');
			]]>
		</sql>
	</diff>

	<diff>
		<version>1.1.2</version>
		<author>Ben Wolfe</author>
		<date>Mar 28th 2007</date>
		<description>
			Updating the AMPATH summary and xslt
		</description>
		<sql>
			<![CDATA[
				UPDATE clinical_summary SET summary = '<?xml version=\"1.0\"?>\r\n<clinicalSummaryList>\r\n\r\n#foreach($patientId in $patientSet.patientIds)\r\n$!{fn.setPatientId($patientId)}\r\n<clinicalSummary>\r\n	<id>$!{fn.getPatientAttr(\'PatientIdentifier\', \'identifier\')}</id>\r\n	<name>\r\n		$!{fn.getPatientAttr(\'PatientName\', \'givenName\')} \r\n		$!{fn.getPatientAttr(\'PatientName\', \'middleName\')} \r\n		$!{fn.getPatientAttr(\'PatientName\', \'familyName\')}\r\n	</name>\r\n	<gender>$!{fn.getPatientAttr(\'Patient\', \'gender\')}</gender>\r\n	#set($birthdate = $!{fn.getPatientAttr(\'Patient\', \'birthdate\')})\r\n	#set($birthdate_estimated = $!{fn.getPatientAttr(\'Patient\', \'birthdateEstimated\')})\r\n	#set($age = $!{fn.getAge(${birthdate})})\r\n	#if ($!{age.get(1)} == \"days\") #set($age_text = \"$!{age.get(0)} day-old\")\r\n	#else\r\n		#if ($!{age.get(1)} == \"months\") #set($age_text = \"$!{age.get(0)} month-old\")\r\n		#else #set($age_text = \"$!{age.get(0)} year-old\")\r\n		#end\r\n	#end\r\n	<birthdate estimate=\"${birthdate_estimated}\" age=\"$!{age_text}\">\r\n		$!{fn.formatDate(\'dd-MMM-yyyy\',${birthdate})}\r\n	</birthdate>\r\n	<firstEncounterDate>\r\n		$!{fn.formatDate(\'dd-MMM-yyyy\', ${fn.getFirstEncounter(\'\').getEncounterDatetime()})}\r\n	</firstEncounterDate>\r\n	<healthCenter>${fn.getValueAsString($!{fn.getPatientAttr(\'Patient\', \'healthCenter\')})}</healthCenter>\r\n	<whoStage>${fn.getValueAsString(${fn.getLastObs(\'5356\')})}</whoStage>\r\n	<perfectAdherence>\r\n		#set($obsValues = $fn.getObsTimeframe(\'1164\', 12))\r\n		#if (${obsValues.size()} < 1)\r\n			unknown\r\n		#else\r\n			#set($all = true)\r\n			#foreach($val in $obsValues)\r\n				#if (!(${val.getConceptId()} == 1163))#set($all = false)#end\r\n			#end\r\n			#if ($all == true)\r\n				yes\r\n			#else\r\n				no\r\n			#end\r\n		#end\r\n	</perfectAdherence>\r\n	<problemList>\r\n		<!-- Make a list of all PROBLEM ADDED without a subsequent matching PROBLEM RESOLVED -->\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getIntersectedObs(\'6042\', \'6097\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<problem date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0).getName()})}\r\n			</problem>\r\n		#end\r\n	</problemList>\r\n	<flowsheet>\r\n  	<!--\r\n  		List all known values for\r\n  			WEIGHT (KG),\r\n  			HGB (concept HEMOGLOBIN),\r\n  			SAO2 (concept BLOOD OXYGEN SATURATION),\r\n  			CD4 (CD4, BY FACS),\r\n  			SGPT\r\n  		All dates should be in MM-DD-YYYY format\r\n  		For CD4: if CD4% exists on same day, repeat as CD4 (%), e.g. <value date=\"...\">252 (16%)</value>\r\n  	-->\r\n	<results name=\"WEIGHT (KG)\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'5089\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	<results name=\"HGB\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'21\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	<results name=\"SA02\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'5092\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	<results name=\"CD4\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'5497\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	<results name=\"SGPT\">\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'654\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</results>\r\n	</flowsheet>\r\n	<cd4_percent>\r\n		#set($arr = [\'obsDatetime\'])\r\n		#set($obsValues = $fn.getLastNObsWithValues(-1, \'730\', $arr))\r\n		#foreach($vals in $obsValues)\r\n			<value date=\"${fn.formatDate(\'dd-MMM-yyyy\', ${vals.get(1)})}\">\r\n				${fn.getValueAsString(${vals.get(0)})}\r\n			</value>\r\n		#end\r\n	</cd4_percent>\r\n\r\n	#set($arr = [\'obsDatetime\'])\r\n	#set($obsValues = $fn.getLastNObsWithValues(-1, \'12\', $arr))\r\n	#foreach($vals in $obsValues)\r\n		#if($velocityCount == 1)<cxr date=\"${fn.formatDate(\'short\', ${vals.get(1)})}\">#end\r\n			${fn.getValueAsString(${vals.get(0)})}\r\n			#if($velocityCount > 1) , #end\r\n		#if($velocityCount == ${obsValues.size()})</cxr>#end\r\n	#end\r\n\r\n	#set($medValues = ${fn.getAmpathActiveMedications()})\r\n	#foreach($vals in $medValues)\r\n		#if($velocityCount == 1)<medications>#end\r\n		<medication date=\"${fn.formatDate(\'short\', ${vals.get(1)})}\">\r\n			${fn.getValueAsString(${vals.get(0)})}\r\n		</medication>\r\n		#if($velocityCount == ${medValues.size()})</medications>#end\r\n	#end\r\n\r\n</clinicalSummary>\r\n#end <!-- ending patient loop -->\r\n\r\n</clinicalSummaryList>\r\n' where clinical_summary_id = 2;
				UPDATE clinical_summary SET xslt = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" \r\n	xmlns:fo=\"http://www.w3.org/1999/XSL/Format\" xmlns:fn=\"http://www.w3.org/2005/02/xpath-functions\"\r\n	exclude-result-prefixes=\"fo\">\r\n<xsl:output method=\"xml\" version=\"1.0\" omit-xml-declaration=\"no\" indent=\"yes\"/>\r\n\r\n<xsl:summary match=\"clinicalSummaryList\">\r\n<fo:root xmlns:fo=\"http://www.w3.org/1999/XSL/Format\">\r\n	<fo:layout-master-set>\r\n		<fo:simple-page-master master-name=\"simpleA4\" page-height=\"29.7cm\" page-width=\"21cm\"\r\n			margin-top=\"1cm\" margin-left=\"1cm\" margin-right=\"1cm\" margin-bottom=\"1cm\">\r\n			<fo:region-body margin-top=\"1.2cm\" margin-bottom=\"1.2cm\" />\r\n			<fo:region-before extent=\"3cm\"  />\r\n			<fo:region-after extent=\"1cm\" />\r\n		</fo:simple-page-master>\r\n	</fo:layout-master-set>\r\n	\r\n	<!-- Begin Summary -->\r\n	<xsl:for-each select=\"clinicalSummary\">\r\n	<fo:page-sequence master-reference=\"simpleA4\">\r\n		<!-- Header -->\r\n		<fo:static-content flow-name=\"xsl-region-before\" font-family=\"Helvetica\">\r\n			<fo:block text-align=\"center\"\r\n				border-top=\"thin solid grey\"\r\n				border-left=\"thin solid grey\"\r\n				border-right=\"thin solid black\"\r\n				border-bottom=\"thin solid black\"\r\n				background-color=\"#e0e0e0\"\r\n				padding=\"0.2cm\"\r\n				space-after=\"12pt\"\r\n				font-weight=\"bold\">AMPATH Medical Record System Clinical Summary</fo:block>\r\n		</fo:static-content>\r\n		<!-- Footer -->\r\n		<fo:static-content flow-name=\"xsl-region-after\" font-family=\"Helvetica\">\r\n			<fo:table table-layout=\"fixed\" width=\"100%\">\r\n				<fo:table-column column-width=\"60%\" />\r\n				<fo:table-column column-width=\"40%\" />\r\n				<fo:table-body>\r\n					<fo:table-row height=\"1cm\">\r\n						<fo:table-cell display-align=\"center\">\r\n							<fo:block text-align=\"left\" font-size=\"8pt\">Printed on <xsl:value-of select=\"format-dateTime(current-dateTime(),\'[Y0001]-[M01]-[D01] at [H01]:[m01]:[s01]\')\" /></fo:block>\r\n						</fo:table-cell>\r\n						<fo:table-cell display-align=\"center\">\r\n							<fo:block text-align=\"right\" font-size=\"20pt\" font-weight=\"bold\">\r\n								<xsl:value-of select=\"id\" />\r\n							</fo:block>\r\n						</fo:table-cell>\r\n					</fo:table-row>\r\n				</fo:table-body>\r\n			</fo:table>		\r\n			<fo:block>\r\n			</fo:block>\r\n		</fo:static-content>\r\n		\r\n		<!-- Begin Page Content -->\r\n		<fo:flow flow-name=\"xsl-region-body\" font-family=\"Helvetica\" font-size=\"14pt\">\r\n			<fo:table table-layout=\"fixed\" width=\"100%\">\r\n				<fo:table-column column-width=\"60%\" />\r\n				<fo:table-column column-width=\"40%\" />\r\n				<fo:table-body font-size=\"20pt\">\r\n					<fo:table-row height=\"1cm\">\r\n						<fo:table-cell>\r\n							<fo:block font-weight=\"bold\" font-style=\"italic\"><xsl:value-of select=\"name\" /></fo:block>\r\n						</fo:table-cell>\r\n						<fo:table-cell text-align=\"right\">\r\n							<fo:block font-weight=\"bold\"><xsl:value-of select=\"id\" /></fo:block>\r\n						</fo:table-cell>\r\n					</fo:table-row>\r\n				</fo:table-body>\r\n			</fo:table>\r\n			<fo:block font-size=\"14pt\" space-after=\"6pt\">\r\n				<fo:inline><xsl:value-of select=\"birthdate/@age\" /></fo:inline>\r\n				<xsl:choose>\r\n					<xsl:when test=\"gender = \'M\'\">\r\n						<fo:inline> male</fo:inline>\r\n					</xsl:when>\r\n					<xsl:when test=\"gender = \'F\'\">\r\n						<fo:inline> female</fo:inline>\r\n					</xsl:when>\r\n				</xsl:choose>\r\n			</fo:block>\r\n			<fo:block>\r\n				<fo:inline>First Encounter on <xsl:value-of select=\"firstEncounterDate\" /></fo:inline>\r\n			</fo:block>\r\n			<fo:block>\r\n				<fo:inline>WHO Stage: <xsl:value-of select=\"whoStage\" /></fo:inline>\r\n			</fo:block>\r\n			<fo:block>Perfect HIV Rx Adherence (past year): <xsl:value-of select=\"perfectAdherence\" /></fo:block>\r\n			<!-- <fo:block text-align=\"center\" space-before=\"12pt\" space-after=\"12pt\">\r\n				<fo:leader leader-summary=\"rule\" leader-length=\"80%\" color=\"#808080\" />\r\n			</fo:block> -->\r\n			\r\n			<fo:table table-layout=\"fixed\"\r\n				width=\"100%\"\r\n				border-spacing=\"0.25in\" space-before=\"6pt\"\r\n				space-after=\"6pt\">\r\n				<fo:table-column column-width=\"50%\" />\r\n				<fo:table-column column-width=\"50%\" />\r\n				<fo:table-body font-size=\"20pt\">\r\n					<fo:table-row height=\"7cm\">\r\n						<fo:table-cell>\r\n\r\n			<!-- Problem list -->\r\n			<fo:block font-size=\"18pt\"\r\n				space-before=\"8pt\"\r\n				space-after=\"8pt\"><fo:inline text-decoration=\"underline\">Problem List</fo:inline>:</fo:block>\r\n			<xsl:if test=\"problemList/problem\">\r\n				<fo:list-block font-size=\"14pt\" space-after=\"12pt\"\r\n					provisional-label-separation=\"4mm\" provisional-distance-between-starts=\"10mm\">\r\n					<xsl:for-each select=\"problemList/problem\">\r\n					<fo:list-item>\r\n						<fo:list-item-label end-indent=\"label-end()\">\r\n							<fo:block><xsl:value-of select=\"position()\" />.</fo:block>\r\n						</fo:list-item-label>\r\n						<fo:list-item-body start-indent=\"body-start()\">\r\n							<fo:block>\r\n								<xsl:value-of select=\".\" />\r\n								<xsl:if test=\"@date\">\r\n									<xsl:text> (</xsl:text>\r\n									<xsl:value-of select=\"@date\" />\r\n									<xsl:text>)</xsl:text>\r\n								</xsl:if>\r\n							</fo:block>\r\n						</fo:list-item-body>\r\n					</fo:list-item>\r\n					</xsl:for-each>\r\n				</fo:list-block>\r\n			</xsl:if>\r\n\r\n						</fo:table-cell>\r\n						<fo:table-cell>\r\n						\r\n			<!-- Medications -->\r\n			<fo:block font-size=\"18pt\"\r\n				space-before=\"8pt\"\r\n				space-after=\"8pt\"><fo:inline text-decoration=\"underline\">Medications</fo:inline>:</fo:block>\r\n			<xsl:if test=\"medications/medication\">\r\n				<fo:list-block font-size=\"14pt\" space-after=\"12pt\"\r\n					provisional-label-separation=\"4mm\" provisional-distance-between-starts=\"10mm\">\r\n					<xsl:for-each select=\"medications/medication\">\r\n					<fo:list-item>\r\n						<fo:list-item-label end-indent=\"label-end()\">\r\n							<fo:block><xsl:value-of select=\"position()\" />.</fo:block>\r\n						</fo:list-item-label>\r\n						<fo:list-item-body start-indent=\"body-start()\">\r\n							<fo:block>\r\n								<xsl:value-of select=\".\" />\r\n								<!--\r\n								<xsl:if test=\"@date\">\r\n									<xsl:text> (</xsl:text>\r\n									<xsl:value-of select=\"@date\" />\r\n									<xsl:text>)</xsl:text>\r\n								</xsl:if>\r\n								-->\r\n							</fo:block>\r\n						</fo:list-item-body>\r\n					</fo:list-item>\r\n					</xsl:for-each>\r\n				</fo:list-block>\r\n			</xsl:if>\r\n\r\n						</fo:table-cell>\r\n					</fo:table-row>\r\n				</fo:table-body>\r\n			</fo:table>\r\n\r\n			<!-- Flowsheet -->\r\n			<fo:block font-size=\"18pt\"><fo:inline text-decoration=\"underline\">Flowsheet</fo:inline>:</fo:block>\r\n			<fo:table space-after=\"12pt\" table-layout=\"fixed\" width=\"100%\" border-collapse=\"collapse\">\r\n				<xsl:for-each select=\"flowsheet/results\">\r\n				<fo:table-column width=\"16%\" />\r\n				</xsl:for-each>\r\n				<fo:table-body>\r\n					<fo:table-row>\r\n						<xsl:for-each select=\"flowsheet/results\">\r\n							<xsl:element name=\"fo:table-cell\">\r\n								<xsl:attribute name=\"text-align\">center</xsl:attribute>\r\n								<xsl:attribute name=\"padding\">2pt</xsl:attribute>\r\n								<xsl:attribute name=\"border-bottom\">thin solid black</xsl:attribute>\r\n								<xsl:if test=\"not(position()=last())\">\r\n									<xsl:attribute name=\"border-right\">thin solid black</xsl:attribute>\r\n								</xsl:if>\r\n								<fo:block><xsl:value-of select=\"@name\" /></fo:block>\r\n							</xsl:element>\r\n						</xsl:for-each>\r\n					</fo:table-row>\r\n					<xsl:variable name=\"results\" select=\"flowsheet/results\" />\r\n					<xsl:variable name=\"cd4_percent\" select=\"cd4_percent\" />\r\n					<xsl:for-each select=\"(1,2,3,4,5)\">\r\n						<xsl:variable name=\"i\" select=\"position()\" />\r\n						<xsl:element name=\"fo:table-row\">\r\n							<xsl:attribute name=\"background-color\">\r\n								<xsl:if test=\"$i mod 2\">#F8F8F8</xsl:if>\r\n								<xsl:if test=\"not($i mod 2)\">#FFFFFF</xsl:if>\r\n							</xsl:attribute>\r\n							<xsl:attribute name=\"height\">1cm</xsl:attribute>\r\n							<xsl:for-each select=\"$results\">\r\n								<xsl:variable name=\"result_name\" select=\"@name\" />\r\n								<xsl:element name=\"fo:table-cell\">\r\n									<xsl:attribute name=\"text-align\">center</xsl:attribute>\r\n									<xsl:attribute name=\"display-align\">center</xsl:attribute>\r\n									<xsl:attribute name=\"padding\">2pt</xsl:attribute>\r\n									<xsl:if test=\"not(position()=last())\">\r\n										<xsl:attribute name=\"border-right\">thin solid black</xsl:attribute>\r\n									</xsl:if>\r\n									<xsl:choose>\r\n										<xsl:when test=\"($i=5) and (count(value) > 5)\">\r\n											<xsl:variable name=\"result_date\" select=\"value[position()=last()]/@date\" />\r\n											<fo:block>\r\n												<xsl:value-of select=\"value[position()=last()]\" />\r\n												<xsl:if test=\"$result_name=\'CD4\'\">\r\n													<xsl:variable name=\"p\" select=\"$cd4_percent/value[@date=$result_date]\" />\r\n													<xsl:if test=\"$p\">\r\n														<xsl:text> (</xsl:text>\r\n														<xsl:value-of select=\"normalize-space($p[position()=1])\" />\r\n														<xsl:text>%)</xsl:text>\r\n													</xsl:if>\r\n												</xsl:if>\r\n											</fo:block>\r\n											<xsl:if test=\"$result_date\">\r\n												<fo:block font-size=\"6pt\" font-style=\"italic\" color=\"#808080\">on <xsl:value-of select=\"substring($result_date,0,12)\" /></fo:block>\r\n											</xsl:if>\r\n										</xsl:when>\r\n										<xsl:when test=\"value[$i]\">\r\n											<xsl:variable name=\"result_date\" select=\"value[$i]/@date\" />\r\n											<fo:block>\r\n												<xsl:value-of select=\"value[$i]\" />\r\n												<xsl:if test=\"$result_name=\'CD4\'\">\r\n													<xsl:variable name=\"p\" select=\"$cd4_percent/value[@date=$result_date]\" />\r\n													<xsl:if test=\"$p\">\r\n														<xsl:text> (</xsl:text>\r\n														<xsl:value-of select=\"normalize-space($p[position()=1])\" />\r\n														<xsl:text>%)</xsl:text>\r\n													</xsl:if>\r\n												</xsl:if>\r\n											</fo:block>\r\n											<xsl:if test=\"$result_date\">\r\n												<fo:block font-size=\"6pt\" font-style=\"italic\" color=\"#808080\">on <xsl:value-of select=\"substring($result_date,0,12)\" /></fo:block>\r\n											</xsl:if>\r\n										</xsl:when>\r\n										<xsl:otherwise>\r\n											<fo:block></fo:block>\r\n										</xsl:otherwise>\r\n									</xsl:choose>\r\n								</xsl:element>\r\n							</xsl:for-each>\r\n						</xsl:element>\r\n					</xsl:for-each>\r\n				</fo:table-body>\r\n			</fo:table>\r\n			\r\n			<!-- Chest X-ray -->\r\n			<fo:block font-size=\"18pt\" text-decoration=\"underline\" space-after=\"6pt\">\r\n				Chest X-ray\r\n			</fo:block>\r\n			<xsl:choose>\r\n				<xsl:when test=\"cxr\">\r\n					<fo:block><xsl:value-of select=\"cxr/@date\" />: <xsl:value-of select=\"cxr\" /></fo:block>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<fo:block>No chest x-ray results available.</fo:block>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n			\r\n			<!-- Reminders -->\r\n			<xsl:if test=\"reminderList\">\r\n				<fo:block font-size=\"18pt\" text-decoration=\"underline\" space-before=\"6pt\">\r\n					Reminders\r\n				</fo:block>\r\n				<xsl:for-each select=\"reminderList/reminder\">\r\n					<fo:block space-before=\"6pt\"><xsl:value-of select=\".\" /></fo:block>\r\n				</xsl:for-each>\r\n			</xsl:if>\r\n		</fo:flow>\r\n	</fo:page-sequence>\r\n	</xsl:for-each>\r\n</fo:root>\r\n</xsl:summary>\r\n\r\n</xsl:stylesheet>\r\n' where clinical_summary_id = 2;
			]]>
		</sql>
	</diff>

	<diff>
		<version>1.3.0</version>
		<author>Ben Wolfe</author>
		<date>April 2nd 2007</date>
		<description>
			Change encounter attrs in summary
		</description>
		<sql>
			UPDATE
			clinical_summary
			SET
			summary = REPLACE(summary, "getFirstEncounter('').getEncounterDatetime()", "getFirstEncounterAttrsByType([''],
			'encounterDatetime')");
		</sql>
	</diff>

	<diff>
		<version>1.8.0</version>
		<author>Ben Wolfe</author>
		<date>April 2nd 2007</date>
		<description>
			Change summaries to match person branch updates
		</description>
		<sql>
			UPDATE
			clinical_summary
			SET
			summary = REPLACE(summary, "getPatientAttr('PatientName'", "getPatientAttr('PersonName'");
			UPDATE
			clinical_summary
			SET
			summary = REPLACE(summary, "getPatientAttr('PatientAddress'", "getPatientAttr('PersonAddress'");
			UPDATE
			clinical_summary
			SET
			summary = REPLACE(summary, "('Patient', 'gender')", "('Person', 'gender')");
			UPDATE
			clinical_summary
			SET
			summary = REPLACE(summary, "('Patient', 'birthdate')", "('Person', 'birthdate')");
			UPDATE
			clinical_summary
			SET
			summary = REPLACE(summary, "('Patient', 'birthdateEstimated')", "('Person', 'birthdateEstimated')");
			UPDATE
			clinical_summary
			SET
			summary = REPLACE(summary, "('Patient', 'causeOfDeath')", "('Person', 'causeOfDeath')");
			UPDATE
			clinical_summary
			SET
			summary = REPLACE(summary, "('Patient', 'deathDate')", "('Person', 'deathDate')");
			UPDATE
			clinical_summary
			SET
			summary = REPLACE(summary, "fn.getPatientAttr('Patient', 'healthCenter')", "fn.getPersonAttribute('Health Center',
			'Location', 'locationId', 'name', false)");
			UPDATE
			clinical_summary
			SET
			summary = REPLACE(summary, "fn.getPatientAttribute('Patient', 'race')", "fn.getPersonAttribute('Race')");
		</sql>
	</diff>


	<diff>
		<version>1.9.0</version>
		<author>Ben Wolfe</author>
		<date>April 2nd 2007</date>
		<description>
			Change basic summary's "xslt string" to AMPATH xslt
		</description>
		<sql>
			<![CDATA[
				UPDATE clinical_summary set xslt = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" \r\n	xmlns:fo=\"http://www.w3.org/1999/XSL/Format\" xmlns:fn=\"http://www.w3.org/2005/02/xpath-functions\"\r\n	exclude-result-prefixes=\"fo\">\r\n<xsl:output method=\"xml\" version=\"1.0\" omit-xml-declaration=\"no\" indent=\"yes\"/>\r\n\r\n<xsl:summary match=\"clinicalSummaryList\">\r\n<fo:root xmlns:fo=\"http://www.w3.org/1999/XSL/Format\">\r\n	<fo:layout-master-set>\r\n		<fo:simple-page-master master-name=\"simpleA4\" page-height=\"29.7cm\" page-width=\"21cm\"\r\n			margin-top=\"1cm\" margin-left=\"1cm\" margin-right=\"1cm\" margin-bottom=\"1cm\">\r\n			<fo:region-body margin-top=\"1.2cm\" margin-bottom=\"1.2cm\" />\r\n			<fo:region-before extent=\"3cm\"  />\r\n			<fo:region-after extent=\"1cm\" />\r\n		</fo:simple-page-master>\r\n	</fo:layout-master-set>\r\n	\r\n	<!-- Begin Summary -->\r\n	<xsl:for-each select=\"clinicalSummary\">\r\n	<fo:page-sequence master-reference=\"simpleA4\">\r\n		<!-- Header -->\r\n		<fo:static-content flow-name=\"xsl-region-before\" font-family=\"Helvetica\">\r\n			<fo:block text-align=\"center\"\r\n				border-top=\"thin solid grey\"\r\n				border-left=\"thin solid grey\"\r\n				border-right=\"thin solid black\"\r\n				border-bottom=\"thin solid black\"\r\n				background-color=\"#e0e0e0\"\r\n				padding=\"0.2cm\"\r\n				space-after=\"12pt\"\r\n				font-weight=\"bold\">AMPATH Medical Record System Clinical Summary</fo:block>\r\n		</fo:static-content>\r\n		<!-- Footer -->\r\n		<fo:static-content flow-name=\"xsl-region-after\" font-family=\"Helvetica\">\r\n			<fo:table table-layout=\"fixed\" width=\"100%\">\r\n				<fo:table-column column-width=\"60%\" />\r\n				<fo:table-column column-width=\"40%\" />\r\n				<fo:table-body>\r\n					<fo:table-row height=\"1cm\">\r\n						<fo:table-cell display-align=\"center\">\r\n							<fo:block text-align=\"left\" font-size=\"8pt\">Printed on <xsl:value-of select=\"format-dateTime(current-dateTime(),\'[Y0001]-[M01]-[D01] at [H01]:[m01]:[s01]\')\" /></fo:block>\r\n						</fo:table-cell>\r\n						<fo:table-cell display-align=\"center\">\r\n							<fo:block text-align=\"right\" font-size=\"20pt\" font-weight=\"bold\">\r\n								<xsl:value-of select=\"id\" />\r\n							</fo:block>\r\n						</fo:table-cell>\r\n					</fo:table-row>\r\n				</fo:table-body>\r\n			</fo:table>		\r\n			<fo:block>\r\n			</fo:block>\r\n		</fo:static-content>\r\n		\r\n		<!-- Begin Page Content -->\r\n		<fo:flow flow-name=\"xsl-region-body\" font-family=\"Helvetica\" font-size=\"14pt\">\r\n			<fo:table table-layout=\"fixed\" width=\"100%\">\r\n				<fo:table-column column-width=\"60%\" />\r\n				<fo:table-column column-width=\"40%\" />\r\n				<fo:table-body font-size=\"20pt\">\r\n					<fo:table-row height=\"1cm\">\r\n						<fo:table-cell>\r\n							<fo:block font-weight=\"bold\" font-style=\"italic\"><xsl:value-of select=\"name\" /></fo:block>\r\n						</fo:table-cell>\r\n						<fo:table-cell text-align=\"right\">\r\n							<fo:block font-weight=\"bold\"><xsl:value-of select=\"id\" /></fo:block>\r\n						</fo:table-cell>\r\n					</fo:table-row>\r\n				</fo:table-body>\r\n			</fo:table>\r\n			<fo:block font-size=\"14pt\" space-after=\"6pt\">\r\n				<fo:inline><xsl:value-of select=\"birthdate/@age\" /></fo:inline>\r\n				<xsl:choose>\r\n					<xsl:when test=\"gender = \'M\'\">\r\n						<fo:inline> male</fo:inline>\r\n					</xsl:when>\r\n					<xsl:when test=\"gender = \'F\'\">\r\n						<fo:inline> female</fo:inline>\r\n					</xsl:when>\r\n				</xsl:choose>\r\n			</fo:block>\r\n			<fo:block>\r\n				<fo:inline>First Encounter on <xsl:value-of select=\"firstEncounterDate\" /></fo:inline>\r\n			</fo:block>\r\n			<fo:block>\r\n				<fo:inline>WHO Stage: <xsl:value-of select=\"whoStage\" /></fo:inline>\r\n			</fo:block>\r\n			<fo:block>Perfect HIV Rx Adherence (past year): <xsl:value-of select=\"perfectAdherence\" /></fo:block>\r\n			<!-- <fo:block text-align=\"center\" space-before=\"12pt\" space-after=\"12pt\">\r\n				<fo:leader leader-summary=\"rule\" leader-length=\"80%\" color=\"#808080\" />\r\n			</fo:block> -->\r\n			\r\n			<fo:table table-layout=\"fixed\"\r\n				width=\"100%\"\r\n				border-spacing=\"0.25in\" space-before=\"6pt\"\r\n				space-after=\"6pt\">\r\n				<fo:table-column column-width=\"50%\" />\r\n				<fo:table-column column-width=\"50%\" />\r\n				<fo:table-body font-size=\"20pt\">\r\n					<fo:table-row height=\"7cm\">\r\n						<fo:table-cell>\r\n\r\n			<!-- Problem list -->\r\n			<fo:block font-size=\"18pt\"\r\n				space-before=\"8pt\"\r\n				space-after=\"8pt\"><fo:inline text-decoration=\"underline\">Problem List</fo:inline>:</fo:block>\r\n			<xsl:if test=\"problemList/problem\">\r\n				<fo:list-block font-size=\"14pt\" space-after=\"12pt\"\r\n					provisional-label-separation=\"4mm\" provisional-distance-between-starts=\"10mm\">\r\n					<xsl:for-each select=\"problemList/problem\">\r\n					<fo:list-item>\r\n						<fo:list-item-label end-indent=\"label-end()\">\r\n							<fo:block><xsl:value-of select=\"position()\" />.</fo:block>\r\n						</fo:list-item-label>\r\n						<fo:list-item-body start-indent=\"body-start()\">\r\n							<fo:block>\r\n								<xsl:value-of select=\".\" />\r\n								<xsl:if test=\"@date\">\r\n									<xsl:text> (</xsl:text>\r\n									<xsl:value-of select=\"@date\" />\r\n									<xsl:text>)</xsl:text>\r\n								</xsl:if>\r\n							</fo:block>\r\n						</fo:list-item-body>\r\n					</fo:list-item>\r\n					</xsl:for-each>\r\n				</fo:list-block>\r\n			</xsl:if>\r\n\r\n						</fo:table-cell>\r\n						<fo:table-cell>\r\n						\r\n			<!-- Medications -->\r\n			<fo:block font-size=\"18pt\"\r\n				space-before=\"8pt\"\r\n				space-after=\"8pt\"><fo:inline text-decoration=\"underline\">Medications</fo:inline>:</fo:block>\r\n			<xsl:if test=\"medications/medication\">\r\n				<fo:list-block font-size=\"14pt\" space-after=\"12pt\"\r\n					provisional-label-separation=\"4mm\" provisional-distance-between-starts=\"10mm\">\r\n					<xsl:for-each select=\"medications/medication\">\r\n					<fo:list-item>\r\n						<fo:list-item-label end-indent=\"label-end()\">\r\n							<fo:block><xsl:value-of select=\"position()\" />.</fo:block>\r\n						</fo:list-item-label>\r\n						<fo:list-item-body start-indent=\"body-start()\">\r\n							<fo:block>\r\n								<xsl:value-of select=\".\" />\r\n								<!--\r\n								<xsl:if test=\"@date\">\r\n									<xsl:text> (</xsl:text>\r\n									<xsl:value-of select=\"@date\" />\r\n									<xsl:text>)</xsl:text>\r\n								</xsl:if>\r\n								-->\r\n							</fo:block>\r\n						</fo:list-item-body>\r\n					</fo:list-item>\r\n					</xsl:for-each>\r\n				</fo:list-block>\r\n			</xsl:if>\r\n\r\n						</fo:table-cell>\r\n					</fo:table-row>\r\n				</fo:table-body>\r\n			</fo:table>\r\n\r\n			<!-- Flowsheet -->\r\n			<fo:block font-size=\"18pt\"><fo:inline text-decoration=\"underline\">Flowsheet</fo:inline>:</fo:block>\r\n			<fo:table space-after=\"12pt\" table-layout=\"fixed\" width=\"100%\" border-collapse=\"collapse\">\r\n				<xsl:for-each select=\"flowsheet/results\">\r\n				<fo:table-column width=\"16%\" />\r\n				</xsl:for-each>\r\n				<fo:table-body>\r\n					<fo:table-row>\r\n						<xsl:for-each select=\"flowsheet/results\">\r\n							<xsl:element name=\"fo:table-cell\">\r\n								<xsl:attribute name=\"text-align\">center</xsl:attribute>\r\n								<xsl:attribute name=\"padding\">2pt</xsl:attribute>\r\n								<xsl:attribute name=\"border-bottom\">thin solid black</xsl:attribute>\r\n								<xsl:if test=\"not(position()=last())\">\r\n									<xsl:attribute name=\"border-right\">thin solid black</xsl:attribute>\r\n								</xsl:if>\r\n								<fo:block><xsl:value-of select=\"@name\" /></fo:block>\r\n							</xsl:element>\r\n						</xsl:for-each>\r\n					</fo:table-row>\r\n					<xsl:variable name=\"results\" select=\"flowsheet/results\" />\r\n					<xsl:variable name=\"cd4_percent\" select=\"cd4_percent\" />\r\n					<xsl:for-each select=\"(1,2,3,4,5)\">\r\n						<xsl:variable name=\"i\" select=\"position()\" />\r\n						<xsl:element name=\"fo:table-row\">\r\n							<xsl:attribute name=\"background-color\">\r\n								<xsl:if test=\"$i mod 2\">#F8F8F8</xsl:if>\r\n								<xsl:if test=\"not($i mod 2)\">#FFFFFF</xsl:if>\r\n							</xsl:attribute>\r\n							<xsl:attribute name=\"height\">1cm</xsl:attribute>\r\n							<xsl:for-each select=\"$results\">\r\n								<xsl:variable name=\"result_name\" select=\"@name\" />\r\n								<xsl:element name=\"fo:table-cell\">\r\n									<xsl:attribute name=\"text-align\">center</xsl:attribute>\r\n									<xsl:attribute name=\"display-align\">center</xsl:attribute>\r\n									<xsl:attribute name=\"padding\">2pt</xsl:attribute>\r\n									<xsl:if test=\"not(position()=last())\">\r\n										<xsl:attribute name=\"border-right\">thin solid black</xsl:attribute>\r\n									</xsl:if>\r\n									<xsl:choose>\r\n										<xsl:when test=\"($i=5) and (count(value) > 5)\">\r\n											<xsl:variable name=\"result_date\" select=\"value[position()=last()]/@date\" />\r\n											<fo:block>\r\n												<xsl:value-of select=\"value[position()=last()]\" />\r\n												<xsl:if test=\"$result_name=\'CD4\'\">\r\n													<xsl:variable name=\"p\" select=\"$cd4_percent/value[@date=$result_date]\" />\r\n													<xsl:if test=\"$p\">\r\n														<xsl:text> (</xsl:text>\r\n														<xsl:value-of select=\"normalize-space($p[position()=1])\" />\r\n														<xsl:text>%)</xsl:text>\r\n													</xsl:if>\r\n												</xsl:if>\r\n											</fo:block>\r\n											<xsl:if test=\"$result_date\">\r\n												<fo:block font-size=\"6pt\" font-style=\"italic\" color=\"#808080\">on <xsl:value-of select=\"substring($result_date,0,12)\" /></fo:block>\r\n											</xsl:if>\r\n										</xsl:when>\r\n										<xsl:when test=\"value[$i]\">\r\n											<xsl:variable name=\"result_date\" select=\"value[$i]/@date\" />\r\n											<fo:block>\r\n												<xsl:value-of select=\"value[$i]\" />\r\n												<xsl:if test=\"$result_name=\'CD4\'\">\r\n													<xsl:variable name=\"p\" select=\"$cd4_percent/value[@date=$result_date]\" />\r\n													<xsl:if test=\"$p\">\r\n														<xsl:text> (</xsl:text>\r\n														<xsl:value-of select=\"normalize-space($p[position()=1])\" />\r\n														<xsl:text>%)</xsl:text>\r\n													</xsl:if>\r\n												</xsl:if>\r\n											</fo:block>\r\n											<xsl:if test=\"$result_date\">\r\n												<fo:block font-size=\"6pt\" font-style=\"italic\" color=\"#808080\">on <xsl:value-of select=\"substring($result_date,0,12)\" /></fo:block>\r\n											</xsl:if>\r\n										</xsl:when>\r\n										<xsl:otherwise>\r\n											<fo:block></fo:block>\r\n										</xsl:otherwise>\r\n									</xsl:choose>\r\n								</xsl:element>\r\n							</xsl:for-each>\r\n						</xsl:element>\r\n					</xsl:for-each>\r\n				</fo:table-body>\r\n			</fo:table>\r\n			\r\n			<!-- Chest X-ray -->\r\n			<fo:block font-size=\"18pt\" text-decoration=\"underline\" space-after=\"6pt\">\r\n				Chest X-ray\r\n			</fo:block>\r\n			<xsl:choose>\r\n				<xsl:when test=\"cxr\">\r\n					<fo:block><xsl:value-of select=\"cxr/@date\" />: <xsl:value-of select=\"cxr\" /></fo:block>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<fo:block>No chest x-ray results available.</fo:block>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n			\r\n			<!-- Reminders -->\r\n			<xsl:if test=\"reminderList\">\r\n				<fo:block font-size=\"18pt\" text-decoration=\"underline\" space-before=\"6pt\">\r\n					Reminders\r\n				</fo:block>\r\n				<xsl:for-each select=\"reminderList/reminder\">\r\n					<fo:block space-before=\"6pt\"><xsl:value-of select=\".\" /></fo:block>\r\n				</xsl:for-each>\r\n			</xsl:if>\r\n		</fo:flow>\r\n	</fo:page-sequence>\r\n	</xsl:for-each>\r\n</fo:root>\r\n</xsl:summary>\r\n\r\n</xsl:stylesheet>\r\n' where xslt = 'xslt string';
			]]>
		</sql>
	</diff>

	<diff>
		<version>2.0.0</version>
		<author>Ben Wolfe</author>
		<date>May 18th 2007</date>
		<description>
			Adding summary printing queue
		</description>
		<sql>
			<![CDATA[
				CREATE TABLE clinical_summary_print_queue (
				  clinicalsummary_queue_id int(11) NOT NULL auto_increment,
				  patient_id int(11) NOT NULL default '0',
				  encounter_datetime datetime NOT NULL default '0000-00-00 00:00:00',
				  date_printed datetime default NULL,
				  status varchar(255) NOT NULL default '0' COMMENT 'QUEUED, PRINTING, PRINTED, ERROR, CANCELLED',
				  error_message text,
				  date_created datetime NOT NULL default '0000-00-00 00:00:00',
				  PRIMARY KEY  (clinicalsummary_queue_id),
				  KEY clinical_summary_queue_patient (patient_id),
				  CONSTRAINT clinical_summary_queue_patient FOREIGN KEY (patient_id) REFERENCES patient (patient_id)
				) ;
			]]>
		</sql>
	</diff>

	<diff>
		<version>2.1.0</version>
		<author>Brian McKown</author>
		<date>July 10th 2007</date>
		<description>
			Adding location_id to summary printing queue
		</description>
		<sql>
			<![CDATA[
				ALTER TABLE clinical_summary_print_queue 
					ADD COLUMN location_id int(11) NOT NULL default '-1' AFTER patient_id;

				UPDATE 
					clinical_summary_print_queue q, encounter e
				SET 
					q.location_id = e.location_id 
				WHERE  
					q.encounter_datetime = e.encounter_datetime AND q.patient_id = e.patient_id;
					
				UPDATE
					clinical_summary_print_queue q
				SET
					q.location_id = (select l.location_id from location l limit 1)
				WHERE
					q.location_id = '-1';

				ALTER TABLE clinical_summary_print_queue 
					ADD CONSTRAINT clinical_summary_queue_location FOREIGN KEY clinical_summary_queue_location (location_id) REFERENCES location (location_id);

				ALTER TABLE clinical_summary_print_queue 
					ADD INDEX clinical_summary_queue_location_id(location_id);
			]]>
		</sql>
	</diff>

	<diff>
		<version>2.1.1</version>
		<author>Brian McKown</author>
		<date>July 17th 2007</date>
		<description>
			Adding WAITING_ON_LABS to status attribute. Data previously given status QUEUED changed to WAITING_ON_LABS.
		</description>
		<sql>
			<![CDATA[
			ALTER TABLE clinical_summary_print_queue 
				MODIFY COLUMN status VARCHAR(255) CHARACTER SET utf8 COLLATE utf8_general_ci 
					NOT NULL DEFAULT 0 COMMENT 'WAITING_ON_LABS, QUEUED, PRINTING, PRINTED, ERROR, CANCELLED';
			
			UPDATE clinical_summary_print_queue SET status='WAITING_ON_LABS' WHERE status='QUEUED';
			]]>
		</sql>
	</diff>

	<diff>
		<version>2.1.2</version>
		<author>Brian McKown</author>
		<date>July 18th 2007</date>
		<description>
			Changing QUEUED status to PENDING.
		</description>
		<sql>
			<![CDATA[
			ALTER TABLE clinical_summary_print_queue 
				MODIFY COLUMN status VARCHAR(255) CHARACTER SET utf8 COLLATE utf8_general_ci 
					NOT NULL DEFAULT 0 COMMENT 'WAITING_ON_LABS, PENDING, PRINTING, PRINTED, ERROR, CANCELLED';
			
			UPDATE clinical_summary_print_queue SET status='PENDING' WHERE status='QUEUED';
			]]>
		</sql>
	</diff>

	<diff>
		<version>2.1.3</version>
		<author>Brian McKown</author>
		<date>Sept 19th 2007</date>
		<description>
			Alter clinical_summary_print_queue.status to include status GENERATED.
		</description>
		<sql>
			<![CDATA[
			ALTER TABLE clinical_summary_print_queue 
				MODIFY COLUMN status VARCHAR(255) CHARACTER SET utf8 COLLATE utf8_general_ci 
					NOT NULL DEFAULT 0 COMMENT 'WAITING_ON_LABS, GENERATED, PENDING, PRINTING, PRINTED, ERROR, CANCELLED';			
			]]>
		</sql>
	</diff>

	<diff>
		<version>2.1.4</version>
		<author>Brian McKown</author>
		<date>Sept 20th 2007</date>
		<description>
			Adding filename to summary printing queue
		</description>
		<sql>
			<![CDATA[
					ALTER TABLE clinical_summary_print_queue 
						ADD COLUMN file_name VARCHAR(255) DEFAULT NULL AFTER status;
			]]>
		</sql>
	</diff>

	<diff>
		<version>2.1.5</version>
		<author>Brian McKown</author>
		<date>Dec 29, 2008</date>
		<description>
			Adding encounter_id to clinical_summary_queue_item.
			Allow NULL for patient_id, encounter_datetime, location.
			TODO: Remove patient_id, encounter_datetime, location from the table.
		</description>
		<sql>
			<![CDATA[
                    ALTER TABLE clinical_summary_print_queue
                        MODIFY COLUMN patient_id int(11) NULL DEFAULT '0';
                    ALTER TABLE clinical_summary_print_queue
                        MODIFY COLUMN location_id int(11) NULL DEFAULT '-1';
                    ALTER TABLE clinical_summary_print_queue
                        MODIFY COLUMN encounter_datetime datetime NULL DEFAULT '0000-00-00 00:00:00';
                    ALTER TABLE clinical_summary_print_queue
    		            ADD COLUMN encounter_id int(11) default NULL after clinicalsummary_queue_id;
            ]]>
		</sql>
	</diff>

	<diff>
		<version>2.1.6</version>
		<author>Nyoman Ribeka</author>
		<date>Feb 16th 2010</date>
		<description>
			Create the summary loggable table to record all failing summary
		</description>
		<sql>
			CREATE TABLE IF NOT EXISTS clinical_summary_error (
				summary_error_id int(11) NOT NULL auto_increment,
				patient_id int(11) NOT NULL,
				template_id int(11) NOT NULL,
				type varchar(255) NOT NULL,
				loggable varchar(255) NOT NULL,
				error_details text ,
				creator int(11) NOT NULL default '0',
				date_created datetime NOT NULL default '0000-00-00 00:00:00',
				changed_by int(11) default NULL,
				date_changed datetime default '0000-00-00 00:00:00',
				PRIMARY KEY (summary_error_id),
				KEY clinical_summary_error_creator (creator),
				KEY clinical_summary_error_changer (changed_by),
				CONSTRAINT clinical_summary_error_creator FOREIGN KEY (creator) REFERENCES users (user_id),
				CONSTRAINT user_who_changed_clinical_summary_error FOREIGN KEY (changed_by) REFERENCES users (user_id)
			) ;
		</sql>
	</diff>

	<diff>
		<version>2.1.7</version>
		<author>Nyoman Ribeka</author>
		<date>Feb 16th 2010</date>
		<description>
			Create the summary index table to record all summary
		</description>
		<sql>
			CREATE TABLE IF NOT EXISTS clinical_summary_index (
				index_id int(11) NOT NULL auto_increment,
				patient_id int(11),
				location_id int(11),
				return_date datetime default '0000-00-00 00:00:00',
				creator int(11) NOT NULL default '0',
				date_created datetime NOT NULL default '0000-00-00 00:00:00',
				changed_by int(11) default NULL,
				date_changed datetime default '0000-00-00 00:00:00',
				PRIMARY KEY (index_id),
				KEY clinical_index_creator (creator),
				KEY clinical_index_changer (changed_by),
				CONSTRAINT clinical_index_creator FOREIGN KEY (creator) REFERENCES users (user_id),
				CONSTRAINT user_who_changed_clinical_index FOREIGN KEY (changed_by) REFERENCES users (user_id)
			) ;
		</sql>
	</diff>

	<diff>
		<version>2.1.8</version>
		<author>Nyoman Ribeka</author>
		<date>Feb 16th 2010</date>
		<description>
			Create the summary mapping table
		</description>
		<sql>
			CREATE TABLE IF NOT EXISTS clinical_summary_mapping (
				clinical_summary_id int(11) NOT NULL,
				encounter_type_id int(11) NOT NULL,
				PRIMARY KEY (clinical_summary_id, encounter_type_id),
				CONSTRAINT clinical_mapping_template FOREIGN KEY (clinical_summary_id) REFERENCES clinical_summary (clinical_summary_id),
				CONSTRAINT clinical_mapping_encounter_type FOREIGN KEY (encounter_type_id) REFERENCES encounter_type (encounter_type_id)
			);
		</sql>
	</diff>

	<diff>
		<version>2.1.9</version>
		<author>Nyoman Ribeka</author>
		<date>July 01 2010</date>
		<description>
			Drop not needed column on clinical_summary_error table
		</description>
		<sql>
			ALTER TABLE clinical_summary_error DROP COLUMN template_id;
			ALTER TABLE clinical_summary_error DROP COLUMN type;
			ALTER TABLE clinical_summary_error DROP COLUMN loggable;
		</sql>
	</diff>

	<diff>
		<version>2.2.1</version>
		<author>Nyoman Ribeka</author>
		<date>July 03 2010</date>
		<description>
			Add summary column clinical_summary_index table
		</description>
		<sql>
			ALTER TABLE clinical_summary_index ADD COLUMN template_id INT(11) AFTER patient_id;
		</sql>
	</diff>

	<diff>
		<version>2.2.2</version>
		<author>Nyoman Ribeka</author>
		<date>July 03 2010</date>
		<description>
			Add retired column clinical_summary table
		</description>
		<sql>
			ALTER TABLE clinical_summary ADD COLUMN retired INT(1) NOT NULL DEFAULT 0;
		</sql>
	</diff>

	<diff>
		<version>2.2.3</version>
		<author>Nyoman Ribeka</author>
		<date>July 14 2010</date>
		<description>
			Add index on clinical_summary_index table
		</description>
		<sql>
			CREATE INDEX patient_summary_index ON clinical_summary_index (patient_id);
			CREATE INDEX location_summary_index ON clinical_summary_index (location_id);
			CREATE INDEX template_summary_index ON clinical_summary_index (template_id);
		</sql>
	</diff>

	<diff>
		<version>2.2.4</version>
		<author>Nyoman Ribeka</author>
		<date>July 03 2010</date>
		<description>
			Add UUID column clinical_summary and clinical_summary_index table
		</description>
		<sql>
			ALTER TABLE clinical_summary ADD COLUMN uuid VARCHAR(38) DEFAULT NULL;
			UPDATE clinical_summary SET uuid = UUID();
			ALTER TABLE clinical_summary MODIFY COLUMN uuid VARCHAR(38) NOT NULL;
			CREATE UNIQUE INDEX uuid_clinical_summary ON clinical_summary (uuid);

			ALTER TABLE clinical_summary_index ADD COLUMN uuid VARCHAR(38) DEFAULT NULL;
			UPDATE clinical_summary_index SET uuid = UUID();
			ALTER TABLE clinical_summary_index MODIFY COLUMN uuid VARCHAR(38) NOT NULL;
			CREATE UNIQUE INDEX uuid_clinical_summary_index ON clinical_summary_index(uuid);
		</sql>
	</diff>

	<diff>
		<version>2.2.5</version>
		<author>Nyoman Ribeka</author>
		<date>July 14 2010</date>
		<description>
			Add logging tables
		</description>
		<sql>
			CREATE TABLE IF NOT EXISTS clinical_summary_loggable (
				loggable_id int(11) NOT NULL auto_increment,
				patient_id int(11),
				previous_encounter_id int(11),
				log_source varchar(255) NOT NULL,
				log_type varchar(255) NOT NULL,
				log_datetime datetime NOT NULL DEFAULT '1900-00-00 00:00:00',
				creator int(11) NOT NULL DEFAULT '0',
				date_created datetime NOT NULL DEFAULT '1900-00-00 00:00:00',
				changed_by int(11) default NULL,
				date_changed datetime DEFAULT '1900-00-00 00:00:00',
				voided smallint(6) NOT NULL DEFAULT '0',
				voided_by int(11) DEFAULT NULL,
				date_voided datetime DEFAULT '1900-00-00 00:00:00',
				void_reason varchar(255) DEFAULT NULL,
				uuid varchar(38) NOT NULL,
				PRIMARY KEY (loggable_id),
				KEY clinnical_summary_loggable_creator (creator),
				KEY clinnical_summary_loggable_changer (changed_by),
				KEY clinnical_summary_loggable_voider (voided_by),
				CONSTRAINT clinnical_summary_loggable_creator_fk FOREIGN KEY (creator) REFERENCES users (user_id),
				CONSTRAINT clinnical_summary_loggable_voider_fk FOREIGN KEY (voided_by) REFERENCES users (user_id),
				CONSTRAINT user_who_changed_clinnical_summary_loggable FOREIGN KEY (changed_by) REFERENCES users (user_id)
			);

			CREATE TABLE IF NOT EXISTS clinical_summary_loggable_initial (
				loggable_id int(11) NOT NULL auto_increment,
				reminder varchar(255),
				token varchar(255) NOT NULL,
				PRIMARY KEY (loggable_id),
				CONSTRAINT initial_loggable FOREIGN KEY (loggable_id) REFERENCES clinical_summary_loggable (loggable_id)
			);

			CREATE TABLE IF NOT EXISTS clinical_summary_loggable_final (
				loggable_id int(11) NOT NULL auto_increment,
				current_encounter_id int(11),
				PRIMARY KEY (loggable_id),
				CONSTRAINT final_loggable FOREIGN KEY (loggable_id) REFERENCES clinical_summary_loggable (loggable_id)
			);
		</sql>
	</diff>

	<diff>
		<version>2.2.6</version>
		<author>Nyoman Ribeka</author>
		<date>July 26 2010</date>
		<description>
			Add mapping position clinical_summary table
		</description>
		<sql>
			ALTER TABLE clinical_summary ADD COLUMN position VARCHAR(255) NOT NULL AFTER xslt;
		</sql>
	</diff>

	<diff>
		<version>2.2.7</version>
		<author>Nyoman Ribeka</author>
		<date>July 26 2010</date>
		<description>
			Add mapping initial_date clinical_summary_index table. This is the first date the patient gets summary
		</description>
		<sql>
			ALTER TABLE clinical_summary_index ADD COLUMN initial_date datetime NOT NULL DEFAULT '1910-01-01 00:00:00' AFTER return_date;
		</sql>
	</diff>

	<diff>
		<version>2.2.8</version>
		<author>Nyoman Ribeka</author>
		<date>July 26 2010</date>
		<description>
			Dropping the logging table as we move the logging to a separate module
		</description>
		<sql>
			DROP TABLE IF EXISTS clinical_summary_loggable_final;
			DROP TABLE IF EXISTS clinical_summary_loggable_initial;
			DROP TABLE IF EXISTS clinical_summary_loggable;
		</sql>
	</diff>

	<diff>
		<version>2.2.9</version>
		<author>Nyoman Ribeka</author>
		<date>August 26 2010</date>
		<description>
			Add generated_date clinical_summary_index table. This is the generated date the summary
		</description>
		<sql>
			ALTER TABLE clinical_summary_index ADD COLUMN generated_date datetime NOT NULL DEFAULT '1910-01-01 00:00:00' AFTER return_date;
		</sql>
	</diff>

	<diff>
		<version>2.3.0</version>
		<author>Nyoman Ribeka</author>
		<date>August 26 2010</date>
		<description>
			Standard weight for age for pediatric patients
		</description>
		<sql>DROP TABLE IF EXISTS clinical_summary_weight_age;
			CREATE TABLE clinical_summary_weight_age (
				standard_id int(11) NOT NULL AUTO_INCREMENT,
				l_value double NOT NULL,
				m_value double NOT NULL,
				s_value double NOT NULL,
				gender varchar(255) NOT NULL,
				age int(11) NOT NULL,
				age_unit varchar(255) NOT NULL,
				PRIMARY KEY (standard_id),
				UNIQUE KEY standard_id (standard_id),
				UNIQUE KEY search_column (age,age_unit,gender)
			);

			INSERT INTO clinical_summary_weight_age VALUES ('1', '0.3487', '3.3464', '0.14602', 'Male', '0', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('2', '0.2297', '4.4709', '0.13395', 'Male', '1', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('3', '0.197', '5.5675', '0.12385', 'Male', '2', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('4', '0.1738', '6.3762', '0.11727', 'Male', '3', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('5', '0.1553', '7.0023', '0.11316', 'Male', '4', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('6', '0.1395', '7.5105', '0.1108', 'Male', '5', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('7', '0.1257', '7.934', '0.10958', 'Male', '6', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('8', '0.1134', '8.297', '0.10902', 'Male', '7', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('9', '0.1021', '8.6151', '0.10882', 'Male', '8', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('10', '0.0917', '8.9014', '0.10881', 'Male', '9', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('11', '0.082', '9.1649', '0.10891', 'Male', '10', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('12', '0.073', '9.4122', '0.10906', 'Male', '11', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('13', '0.0644', '9.6479', '0.10925', 'Male', '12', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('14', '0.0563', '9.8749', '0.10949', 'Male', '13', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('15', '0.0487', '10.0953', '0.10976', 'Male', '14', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('16', '0.0413', '10.3108', '0.11007', 'Male', '15', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('17', '0.0343', '10.5228', '0.11041', 'Male', '16', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('18', '0.0275', '10.7319', '0.11079', 'Male', '17', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('19', '0.0211', '10.9385', '0.11119', 'Male', '18', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('20', '0.0148', '11.143', '0.11164', 'Male', '19', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('21', '0.0087', '11.3462', '0.11211', 'Male', '20', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('22', '0.0029', '11.5486', '0.11261', 'Male', '21', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('23', '-0.0028', '11.7504', '0.11314', 'Male', '22', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('24', '-0.0083', '11.9514', '0.11369', 'Male', '23', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('25', '-0.0137', '12.1515', '0.11426', 'Male', '24', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('26', '-0.0189', '12.3502', '0.11485', 'Male', '25', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('27', '-0.024', '12.5466', '0.11544', 'Male', '26', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('28', '-0.0289', '12.7401', '0.11604', 'Male', '27', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('29', '-0.0337', '12.9303', '0.11664', 'Male', '28', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('30', '-0.0385', '13.1169', '0.11723', 'Male', '29', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('31', '-0.0431', '13.3', '0.11781', 'Male', '30', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('32', '-0.0476', '13.4798', '0.11839', 'Male', '31', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('33', '-0.052', '13.6567', '0.11896', 'Male', '32', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('34', '-0.0564', '13.8309', '0.11953', 'Male', '33', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('35', '-0.0606', '14.0031', '0.12008', 'Male', '34', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('36', '-0.0648', '14.1736', '0.12062', 'Male', '35', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('37', '-0.0689', '14.3429', '0.12116', 'Male', '36', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('38', '-0.0729', '14.5113', '0.12168', 'Male', '37', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('39', '-0.0769', '14.6791', '0.1222', 'Male', '38', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('40', '-0.0808', '14.8466', '0.12271', 'Male', '39', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('41', '-0.0846', '15.014', '0.12322', 'Male', '40', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('42', '-0.0883', '15.1813', '0.12373', 'Male', '41', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('43', '-0.092', '15.3486', '0.12425', 'Male', '42', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('44', '-0.0957', '15.5158', '0.12478', 'Male', '43', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('45', '-0.0993', '15.6828', '0.12531', 'Male', '44', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('46', '-0.1028', '15.8497', '0.12586', 'Male', '45', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('47', '-0.1063', '16.0163', '0.12643', 'Male', '46', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('48', '-0.1097', '16.1827', '0.127', 'Male', '47', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('49', '-0.1131', '16.3489', '0.12759', 'Male', '48', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('50', '-0.1165', '16.515', '0.12819', 'Male', '49', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('51', '-0.1198', '16.6811', '0.1288', 'Male', '50', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('52', '-0.123', '16.8471', '0.12943', 'Male', '51', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('53', '-0.1262', '17.0132', '0.13005', 'Male', '52', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('54', '-0.1294', '17.1792', '0.13069', 'Male', '53', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('55', '-0.1325', '17.3452', '0.13133', 'Male', '54', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('56', '-0.1356', '17.5111', '0.13197', 'Male', '55', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('57', '-0.1387', '17.6768', '0.13261', 'Male', '56', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('58', '-0.1417', '17.8422', '0.13325', 'Male', '57', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('59', '-0.1447', '18.0073', '0.13389', 'Male', '58', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('60', '-0.1477', '18.1722', '0.13453', 'Male', '59', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('61', '-0.1506', '18.3366', '0.13517', 'Male', '60', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('62', '0.3487', '3.3464', '0.14602', 'Male', '0', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('63', '0.2776', '3.4879', '0.14483', 'Male', '1', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('64', '0.2581', '3.7529', '0.14142', 'Male', '2', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('65', '0.2442', '4.0603', '0.13807', 'Male', '3', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('66', '0.2331', '4.3671', '0.13497', 'Male', '4', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('67', '0.2237', '4.659', '0.13215', 'Male', '5', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('68', '0.2155', '4.9303', '0.1296', 'Male', '6', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('69', '0.2081', '5.1817', '0.12729', 'Male', '7', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('70', '0.2014', '5.4149', '0.1252', 'Male', '8', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('71', '0.1952', '5.6319', '0.1233', 'Male', '9', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('72', '0.1894', '5.8346', '0.12157', 'Male', '10', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('73', '0.184', '6.0242', '0.12001', 'Male', '11', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('74', '0.1789', '6.2019', '0.1186', 'Male', '12', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('75', '0.174', '6.369', '0.11732', 'Male', '13', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('76', '0.3809', '3.2322', '0.14171', 'Female', '0', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('77', '0.1714', '4.1873', '0.13724', 'Female', '1', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('78', '0.0962', '5.1282', '0.13', 'Female', '2', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('79', '0.0402', '5.8458', '0.12619', 'Female', '3', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('80', '-0.005', '6.4237', '0.12402', 'Female', '4', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('81', '-0.043', '6.8985', '0.12274', 'Female', '5', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('82', '-0.0756', '7.297', '0.12204', 'Female', '6', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('83', '-0.1039', '7.6422', '0.12178', 'Female', '7', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('84', '-0.1288', '7.9487', '0.12181', 'Female', '8', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('85', '-0.1507', '8.2254', '0.12199', 'Female', '9', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('86', '-0.17', '8.48', '0.12223', 'Female', '10', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('87', '-0.1872', '8.7192', '0.12247', 'Female', '11', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('88', '-0.2024', '8.9481', '0.12268', 'Female', '12', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('89', '-0.2158', '9.1699', '0.12283', 'Female', '13', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('90', '-0.2278', '9.387', '0.12294', 'Female', '14', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('91', '-0.2384', '9.6008', '0.12299', 'Female', '15', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('92', '-0.2478', '9.8124', '0.12303', 'Female', '16', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('93', '-0.2562', '10.0226', '0.12306', 'Female', '17', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('94', '-0.2637', '10.2315', '0.12309', 'Female', '18', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('95', '-0.2703', '10.4393', '0.12315', 'Female', '19', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('96', '-0.2762', '10.6464', '0.12323', 'Female', '20', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('97', '-0.2815', '10.8534', '0.12335', 'Female', '21', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('98', '-0.2862', '11.0608', '0.1235', 'Female', '22', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('99', '-0.2903', '11.2688', '0.12369', 'Female', '23', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('100', '-0.2941', '11.4775', '0.1239', 'Female', '24', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('101', '-0.2975', '11.6864', '0.12414', 'Female', '25', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('102', '-0.3005', '11.8947', '0.12441', 'Female', '26', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('103', '-0.3032', '12.1015', '0.12472', 'Female', '27', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('104', '-0.3057', '12.3059', '0.12506', 'Female', '28', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('105', '-0.308', '12.5073', '0.12545', 'Female', '29', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('106', '-0.3101', '12.7055', '0.12587', 'Female', '30', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('107', '-0.312', '12.9006', '0.12633', 'Female', '31', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('108', '-0.3138', '13.093', '0.12683', 'Female', '32', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('109', '-0.3155', '13.2837', '0.12737', 'Female', '33', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('110', '-0.3171', '13.4731', '0.12794', 'Female', '34', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('111', '-0.3186', '13.6618', '0.12855', 'Female', '35', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('112', '-0.3201', '13.8503', '0.12919', 'Female', '36', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('113', '-0.3216', '14.0385', '0.12988', 'Female', '37', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('114', '-0.323', '14.2265', '0.13059', 'Female', '38', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('115', '-0.3243', '14.414', '0.13135', 'Female', '39', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('116', '-0.3257', '14.601', '0.13213', 'Female', '40', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('117', '-0.327', '14.7873', '0.13293', 'Female', '41', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('118', '-0.3283', '14.9727', '0.13376', 'Female', '42', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('119', '-0.3296', '15.1573', '0.1346', 'Female', '43', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('120', '-0.3309', '15.341', '0.13545', 'Female', '44', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('121', '-0.3322', '15.524', '0.1363', 'Female', '45', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('122', '-0.3335', '15.7064', '0.13716', 'Female', '46', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('123', '-0.3348', '15.8882', '0.138', 'Female', '47', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('124', '-0.3361', '16.0697', '0.13884', 'Female', '48', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('125', '-0.3374', '16.2511', '0.13968', 'Female', '49', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('126', '-0.3387', '16.4322', '0.14051', 'Female', '50', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('127', '-0.34', '16.6133', '0.14132', 'Female', '51', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('128', '-0.3414', '16.7942', '0.14213', 'Female', '52', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('129', '-0.3427', '16.9748', '0.14293', 'Female', '53', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('130', '-0.344', '17.1551', '0.14371', 'Female', '54', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('131', '-0.3453', '17.3347', '0.14448', 'Female', '55', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('132', '-0.3466', '17.5136', '0.14525', 'Female', '56', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('133', '-0.3479', '17.6916', '0.146', 'Female', '57', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('134', '-0.3492', '17.8686', '0.14675', 'Female', '58', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('135', '-0.3505', '18.0445', '0.14748', 'Female', '59', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('136', '-0.3518', '18.2193', '0.14821', 'Female', '60', 'Month');
			INSERT INTO clinical_summary_weight_age VALUES ('137', '0.3809', '3.2322', '0.14171', 'Female', '0', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('138', '0.2671', '3.3388', '0.146', 'Female', '1', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('139', '0.2304', '3.5693', '0.14339', 'Female', '2', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('140', '0.2024', '3.8352', '0.1406', 'Female', '3', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('141', '0.1789', '4.0987', '0.13805', 'Female', '4', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('142', '0.1582', '4.3476', '0.13583', 'Female', '5', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('143', '0.1395', '4.5793', '0.13392', 'Female', '6', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('144', '0.1224', '4.795', '0.13228', 'Female', '7', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('145', '0.1065', '4.9959', '0.13087', 'Female', '8', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('146', '0.0918', '5.1842', '0.12966', 'Female', '9', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('147', '0.0779', '5.3618', '0.12861', 'Female', '10', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('148', '0.0648', '5.5295', '0.1277', 'Female', '11', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('149', '0.0525', '5.6883', '0.12691', 'Female', '12', 'Week');
			INSERT INTO clinical_summary_weight_age VALUES ('150', '0.0407', '5.8393', '0.12622', 'Female', '13', 'Week');
		</sql>
	</diff>

	<diff>
		<version>2.3.1</version>
		<author>Nyoman Ribeka</author>
		<date>December 13 2010</date>
		<description>
			Added table to list all missing tests ordered and the result
		</description>
		<sql>
			DROP TABLE IF EXISTS clinical_summary_obs_pair;
			CREATE TABLE clinical_summary_obs_pair (
				pair_id int(11) NOT NULL AUTO_INCREMENT,
				patient_id int(11) NOT NULL,
				concept_id int(11) NOT NULL,
				answer_id int(11),
				value double,
				status varchar(255) NOT NULL,
				obs_datetime datetime NOT NULL default '1900-01-01 01:01:01',
				creator int(11) NOT NULL default '0',
				date_created datetime NOT NULL default '1900-01-01 01:01:01',
				PRIMARY KEY (pair_id)
			);
		</sql>
	</diff>

	<diff>
		<version>2.3.2</version>
		<author>Nyoman Ribeka</author>
		<date>July 14 2010</date>
		<description>
			Add index on clinical_summary_index table
		</description>
		<sql>
			CREATE INDEX clinical_summary_obs_pair_patient ON clinical_summary_obs_pair (patient_id);
			CREATE INDEX clinical_summary_obs_pair_concept ON clinical_summary_obs_pair (concept_id);
			CREATE INDEX clinical_summary_obs_pair_answer ON clinical_summary_obs_pair (answer_id);
			CREATE INDEX clinical_summary_obs_pair_datetime ON clinical_summary_obs_pair (obs_datetime);
		</sql>
	</diff>

	<diff>
		<version>2.3.3</version>
		<author>Nyoman Ribeka</author>
		<date>July 14 2010</date>
		<description>
			Add index on clinical_summary_index table
		</description>
		<sql>
			ALTER TABLE clinical_summary ADD COLUMN revision INT(11) NOT NULL DEFAULT 1;
		</sql>
	</diff>

	<diff>
		<version>2.3.4</version>
		<author>Nyoman Ribeka</author>
		<date>January 09 2011</date>
		<description>
			Add scheduler task to register all the rule.
		</description>
		<sql>
			DELETE FROM scheduler_task_config WHERE schedulable_class =
			'org.openmrs.module.clinicalsummary.task.RegisterDefaultRuleTask';
			INSERT INTO scheduler_task_config
			(name, description, schedulable_class, start_time, start_time_pattern, repeat_interval,
			start_on_startup, started, created_by, date_created, uuid)
			VALUES
			('Register Default Rule Task', '', 'org.openmrs.module.clinicalsummary.task.RegisterDefaultRuleTask', NULL,
			'MM/dd/yyyy HH:mm:ss', 0, 0, 1, 1, now(), UUID());
		</sql>
	</diff>

	<diff>
		<version>4.0.0</version>
		<author>Nyoman Ribeka</author>
		<date>March 06 2011</date>
		<description>
			Update the table structure to match the 4.0 model
		</description>
		<sql>
			ALTER TABLE clinical_summary_index CHANGE COLUMN index_id id INTEGER NOT NULL AUTO_INCREMENT;
			ALTER TABLE clinical_summary_index CHANGE COLUMN patient_id patient INTEGER DEFAULT NULL;
			ALTER TABLE clinical_summary_index CHANGE COLUMN template_id summary INTEGER DEFAULT NULL;
			ALTER TABLE clinical_summary_index CHANGE COLUMN location_id location INTEGER DEFAULT NULL;

			RENAME TABLE clinical_summary_error TO clinical_summary_loggable;
			ALTER TABLE clinical_summary_loggable CHANGE COLUMN patient_id patient INTEGER DEFAULT NULL;
			ALTER TABLE clinical_summary_loggable CHANGE COLUMN error_details message TEXT DEFAULT NULL;
			ALTER TABLE clinical_summary_loggable ADD COLUMN summary INT NOT NULL DEFAULT '0' AFTER patient;
		</sql>
	</diff>


	<diff>
		<version>4.0.1</version>
		<author>Nyoman Ribeka</author>
		<date>March 06 2011</date>
		<description>
			Update the table structure to match the 4.0 model
		</description>
		<sql>
			DROP TABLE IF EXISTS clinical_summary_mapping;
			CREATE TABLE IF NOT EXISTS clinical_summary_mapping (
				id int(11) NOT NULL auto_increment,
				summary int(11) DEFAULT NULL,
				encounter_type int(11) DEFAULT NULL,
				mapping_type varchar(255),
				retired smallint(6) NOT NULL DEFAULT '0',
				creator int(11) NOT NULL DEFAULT '0',
				date_created datetime NOT NULL DEFAULT '1900-01-01 00:00:00',
				changed_by int(11) default NULL,
				date_changed datetime DEFAULT '1900-01-01 00:00:00',
				uuid varchar(38) NOT NULL,
				PRIMARY KEY (id),
				CONSTRAINT clinical_summary_mapping_creator_fk FOREIGN KEY (creator) REFERENCES users (user_id),
				CONSTRAINT user_who_changed_clinical_summary_mapping FOREIGN KEY (changed_by) REFERENCES users (user_id)
			);
		</sql>
	</diff>


	<diff>
		<version>4.0.2</version>
		<author>Nyoman Ribeka</author>
		<date>March 06 2011</date>
		<description>
			Update the table structure to match the 4.0 model
		</description>
		<sql>
			RENAME TABLE clinical_summary_obs_pair TO clinical_summary_ordered_observation;
			ALTER TABLE clinical_summary_ordered_observation CHANGE COLUMN pair_id id INTEGER NOT NULL AUTO_INCREMENT;
			ALTER TABLE clinical_summary_ordered_observation CHANGE COLUMN patient_id patient INTEGER DEFAULT NULL;
			ALTER TABLE clinical_summary_ordered_observation DROP COLUMN concept_id;
			ALTER TABLE clinical_summary_ordered_observation DROP COLUMN answer_id;
			ALTER TABLE clinical_summary_ordered_observation DROP COLUMN value;
			ALTER TABLE clinical_summary_ordered_observation ADD COLUMN obs INT NOT NULL DEFAULT '0' AFTER patient;
		</sql>
	</diff>

	<diff>
		<version>4.0.3</version>
		<author>Nyoman Ribeka</author>
		<date>March 06 2011</date>
		<description>
			Update the table structure to match the 4.0 model
		</description>
		<sql>
			ALTER TABLE clinical_summary CHANGE COLUMN summary xml TEXT DEFAULT NULL;
			ALTER TABLE clinical_summary CHANGE COLUMN clinical_summary_id id INTEGER NOT NULL AUTO_INCREMENT;
			ALTER TABLE clinical_summary DROP COLUMN position;

			DROP TABLE clinical_summary_print_queue;
		</sql>
	</diff>

	<diff>
		<version>4.0.4</version>
		<author>Nyoman Ribeka</author>
		<date>March 06 2011</date>
		<description>
			Update the table structure to match the 4.0 model
		</description>
		<sql>
			RENAME TABLE clinical_summary_weight_age TO clinical_summary_weight_standard;
			ALTER TABLE clinical_summary_weight_standard CHANGE COLUMN l_value curve DOUBLE DEFAULT NULL;
			ALTER TABLE clinical_summary_weight_standard CHANGE COLUMN m_value mean DOUBLE DEFAULT NULL;
			ALTER TABLE clinical_summary_weight_standard CHANGE COLUMN s_value coef DOUBLE DEFAULT NULL;

			ALTER TABLE clinical_summary_weight_standard ADD COLUMN creator INTEGER NOT NULL DEFAULT '0';
			UPDATE clinical_summary_weight_standard SET creator = 1;

			ALTER TABLE clinical_summary_weight_standard ADD COLUMN date_created DATETIME NOT NULL DEFAULT '1900-01-01 00:00:00';
			UPDATE clinical_summary_weight_standard SET date_created = NOW();

			ALTER TABLE clinical_summary_weight_standard ADD COLUMN changed_by INTEGER DEFAULT NULL;
			ALTER TABLE clinical_summary_weight_standard ADD COLUMN date_changed DATETIME DEFAULT '1900-01-01 00:00:00';

			ALTER TABLE clinical_summary_weight_standard ADD COLUMN uuid VARCHAR(38) DEFAULT NULL;
			UPDATE clinical_summary_weight_standard SET uuid = UUID();
			ALTER TABLE clinical_summary_weight_standard MODIFY COLUMN uuid VARCHAR(38) NOT NULL;
			CREATE UNIQUE INDEX uuid_clinical_summary_weight_standard_index ON clinical_summary_weight_standard(uuid);
		</sql>
	</diff>

	<diff>
		<version>4.0.5</version>
		<author>Nyoman Ribeka</author>
		<date>March 09 2011</date>
		<description>
			Clear up some unused data
		</description>
		<sql>
			UPDATE clinical_summary SET retired = 1;
			DELETE FROM scheduler_task_config WHERE schedulable_class = 'org.openmrs.module.clinicalsummary.task.RegisterDefaultRuleTask';
		</sql>
	</diff>

	<diff>
		<version>4.0.6</version>
		<author>Nyoman Ribeka</author>
		<date>March 31 2011</date>
		<description>
			More database structure updates
		</description>
		<sql>
			ALTER TABLE clinical_summary_ordered_observation CHANGE COLUMN patient person INTEGER DEFAULT NULL;
			ALTER TABLE clinical_summary_ordered_observation ADD COLUMN ordered_datetime datetime NOT NULL DEFAULT '0000-00-00 00:00:00' AFTER status;
		</sql>
	</diff>

	<diff>
		<version>4.0.7</version>
		<author>Nyoman Ribeka</author>
		<date>March 31 2011</date>
		<description>
			Update all datetime default to 1900-01-01 00:00:00
		</description>
		<sql>
			ALTER TABLE clinical_summary_index ALTER COLUMN initial_date SET DEFAULT '0000-00-00 00:00:00';
			ALTER TABLE clinical_summary_index ALTER COLUMN generated_date SET DEFAULT '0000-00-00 00:00:00';

			ALTER TABLE clinical_summary_ordered_observation ALTER COLUMN obs_datetime SET DEFAULT '0000-00-00 00:00:00';
			ALTER TABLE clinical_summary_ordered_observation ALTER COLUMN date_created SET DEFAULT '0000-00-00 00:00:00';

			ALTER TABLE clinical_summary_mapping ALTER COLUMN date_created SET DEFAULT '0000-00-00 00:00:00';
			ALTER TABLE clinical_summary_mapping ALTER COLUMN date_changed SET DEFAULT '0000-00-00 00:00:00';

			ALTER TABLE clinical_summary_weight_standard ALTER COLUMN date_created SET DEFAULT '0000-00-00 00:00:00';
			ALTER TABLE clinical_summary_weight_standard ALTER COLUMN date_changed SET DEFAULT '0000-00-00 00:00:00';
		</sql>
	</diff>

	<diff>
		<version>4.0.8</version>
		<author>Nyoman Ribeka</author>
		<date>March 31 2011</date>
		<description>
			Reminder object database creation
		</description>
		<sql>
			DROP TABLE IF EXISTS clinical_summary_reminder;
			CREATE TABLE IF NOT EXISTS clinical_summary_reminder (
				id int(11) NOT NULL auto_increment,
				token varchar(255),
				content varchar(1024),
				patient int(11) DEFAULT NULL,
				provider int(11) DEFAULT NULL,
				location int(11) DEFAULT NULL,
				encounter int(11) DEFAULT NULL,
				reminder_datetime datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
				creator int(11) NOT NULL DEFAULT '0',
				date_created datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
				changed_by int(11) default NULL,
				date_changed datetime DEFAULT '0000-00-00 00:00:00',
				uuid varchar(38) NOT NULL,
				PRIMARY KEY (id),
				CONSTRAINT clinical_summary_reminder_creator_fk FOREIGN KEY (creator) REFERENCES users (user_id),
				CONSTRAINT user_who_changed_clinical_summary_reminder FOREIGN KEY (changed_by) REFERENCES users (user_id)
			);
		</sql>
	</diff>

	<diff>
		<version>4.0.9</version>
		<author>Nyoman Ribeka</author>
		<date>March 31 2011</date>
		<description>
			Add concept, value_coded and value_numeric to the ordered table to prevent join
		</description>
		<sql>
			ALTER TABLE clinical_summary_ordered_observation ADD COLUMN concept int(11) NOT NULL DEFAULT '0' AFTER person;
			ALTER TABLE clinical_summary_ordered_observation ADD COLUMN value_coded int(11) NOT NULL DEFAULT '0' AFTER concept;
			ALTER TABLE clinical_summary_ordered_observation ADD COLUMN value_numeric int(11) NOT NULL DEFAULT '0' AFTER value_coded;
		</sql>
	</diff>

	<diff>
		<version>4.1.0</version>
		<author>Nyoman Ribeka</author>
		<date>April 04 2011</date>
		<description>
			Add UUID clinical_summary_ordered_observation
		</description>
		<sql>
			ALTER TABLE clinical_summary_ordered_observation ADD COLUMN uuid VARCHAR(38) DEFAULT NULL;
			UPDATE clinical_summary_ordered_observation SET uuid = UUID();
			ALTER TABLE clinical_summary_ordered_observation MODIFY COLUMN uuid VARCHAR(38) NOT NULL;
			CREATE UNIQUE INDEX uuid_clinical_summary_ordered_observation ON clinical_summary_ordered_observation (uuid);
		</sql>
	</diff>

	<diff>
		<version>4.1.1</version>
		<author>Nyoman Ribeka</author>
		<date>April 04 2011</date>
		<description>
			Fix the ordered table
		</description>
		<sql>
			ALTER TABLE clinical_summary_ordered_observation DROP COLUMN obs_datetime;
			ALTER TABLE clinical_summary_ordered_observation MODIFY COLUMN value_coded int(11) DEFAULT NULL;
			ALTER TABLE clinical_summary_ordered_observation MODIFY COLUMN value_numeric int(11) DEFAULT NULL;
		</sql>
	</diff>

	<diff>
		<version>4.1.2</version>
		<author>Nyoman Ribeka</author>
		<date>April 04 2011</date>
		<description>
			Fix the ordered table
		</description>
		<sql>
			ALTER TABLE clinical_summary_reminder ADD COLUMN parameter varchar(255) DEFAULT NULL AFTER token;
		</sql>
	</diff>

	<diff>
		<version>4.1.3</version>
		<author>Nyoman Ribeka</author>
		<date>April 06 2011</date>
		<description>
			Add provider and location column
		</description>
		<sql>
			ALTER TABLE clinical_summary_ordered_observation ADD COLUMN provider int(11) DEFAULT NULL AFTER person;
			UPDATE clinical_summary_ordered_observation SET provider = (SELECT MIN(user_id) FROM users);
			ALTER TABLE clinical_summary_ordered_observation MODIFY COLUMN provider int(11) NOT NULL;
			ALTER TABLE clinical_summary_ordered_observation ADD COLUMN location int(11) DEFAULT NULL AFTER provider;
			UPDATE clinical_summary_ordered_observation SET location = (SELECT MIN(location_id) FROM location);
			ALTER TABLE clinical_summary_ordered_observation MODIFY COLUMN location int(11) NOT NULL;
		</sql>
	</diff>

	<diff>
		<version>4.1.4</version>
		<author>Nyoman Ribeka</author>
		<date>April 06 2011</date>
		<description>
			Add the medication response table
		</description>
		<sql>
			CREATE TABLE clinical_summary_medication_response (
				id int(11) NOT NULL AUTO_INCREMENT,
				patient int(11) NOT NULL,
				provider int(11) NOT NULL,
				concept int(11) NOT NULL,
				medication_type varchar(255) NOT NULL,
				medication_datetime datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
				status int(1) DEFAULT NULL,
				creator int(11) NOT NULL,
				date_created datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
				uuid varchar(38) NOT NULL,
				PRIMARY KEY (id),
				UNIQUE KEY uuid_clinical_summary_medication_response (uuid),
				KEY clinical_summary_medication_response_patient (patient)
			);
		</sql>
	</diff>

	<diff>
		<version>4.1.5</version>
		<author>Nyoman Ribeka</author>
		<date>April 06 2011</date>
		<description>
			Add the reminder response table
		</description>
		<sql>
			CREATE TABLE clinical_summary_reminder_response (
				id int(11) NOT NULL AUTO_INCREMENT,
				patient int(11) NOT NULL,
				provider int(11) NOT NULL,
				token varchar(255) NOT NULL,
				response varchar(255) NOT NULL,
				reminder_datetime datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
				creator int(11) NOT NULL,
				date_created datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
				uuid varchar(38) NOT NULL,
				PRIMARY KEY (id),
				UNIQUE KEY uuid_clinical_summary_reminder_response (uuid),
				KEY clinical_summary_reminder_response_patient (patient)
			);
		</sql>
	</diff>

	<diff>
		<version>4.1.6</version>
		<author>Nyoman Ribeka</author>
		<date>April 06 2011</date>
		<description>
			Remove the summary column from loggable table
		</description>
		<sql>
			ALTER TABLE clinical_summary_loggable DROP COLUMN summary;
		</sql>
	</diff>

	<diff>
		<version>4.1.7</version>
		<author>Nyoman Ribeka</author>
		<date>April 06 2011</date>
		<description>
			Change the preferred flag to autoGenerate flag
		</description>
		<sql>
			ALTER TABLE clinical_summary CHANGE COLUMN preferred auto_generate INT(1) NOT NULL DEFAULT 0;
		</sql>
	</diff>

	<diff>
		<version>4.1.8</version>
		<author>Nyoman Ribeka</author>
		<date>June 27 2011</date>
		<description>
			Remove the parameter column from the reminder table
		</description>
		<sql>
			ALTER TABLE clinical_summary_reminder DROP COLUMN parameter;
		</sql>
	</diff>

	<diff>
		<version>4.1.9</version>
		<author>Nyoman Ribeka</author>
		<date>June 27 2011</date>
		<description>
			Create unique on summary index on patient and summary
		</description>
		<sql>
			ALTER TABLE clinical_summary_index ADD UNIQUE unique_patient_summary (patient, summary)
		</sql>
	</diff>

	<diff>
		<version>4.1.9</version>
		<author>Nyoman Ribeka</author>
		<date>June 27 2011</date>
		<description>
			Create unique on summary index on patient and summary
		</description>
		<sql>
			ALTER TABLE clinical_summary_index ADD UNIQUE unique_patient_summary (patient, summary)
		</sql>
	</diff>

	<diff>
		<version>4.2.0</version>
		<author>Nyoman Ribeka</author>
		<date>June 27 2011</date>
		<description>
			Removing null not null restriction on column and provider
		</description>
		<sql>
			ALTER TABLE clinical_summary_ordered_observation MODIFY COLUMN location INTEGER  DEFAULT NULL;
			ALTER TABLE clinical_summary_ordered_observation MODIFY COLUMN provider INTEGER  DEFAULT NULL;
		</sql>
	</diff>


	<diff>
		<version>4.2.1</version>
		<author>Nyoman Ribeka</author>
		<date>June 27 2011</date>
		<description>
			Added more column on the response table
		</description>
		<sql>
			ALTER TABLE clinical_summary_medication_response ADD COLUMN action_type varchar(255) DEFAULT NULL AFTER status;
		</sql>
	</diff>

	<diff>
		<version>4.2.2</version>
		<author>Nyoman Ribeka</author>
		<date>June 27 2011</date>
		<description>
			Added more column on the response table
		</description>
		<sql>
			ALTER TABLE clinical_summary_reminder_response ADD COLUMN location INTEGER DEFAULT NULL AFTER provider;
		</sql>
	</diff>

	<diff>
		<version>4.2.3</version>
		<author>Nyoman Ribeka</author>
		<date>June 27 2011</date>
		<description>
			Added more column on the response table
		</description>
		<sql>
			ALTER TABLE clinical_summary_medication_response CHANGE COLUMN concept medication INTEGER DEFAULT NULL;
			ALTER TABLE clinical_summary_medication_response ADD COLUMN location INTEGER DEFAULT NULL AFTER provider;
			ALTER TABLE clinical_summary_medication_response ADD COLUMN reviewer INTEGER DEFAULT NULL AFTER status;
			ALTER TABLE clinical_summary_medication_response ADD COLUMN date_reviewed DATETIME DEFAULT NULL AFTER reviewer;
		</sql>
	</diff>

	<diff>
		<version>4.2.4</version>
		<author>Nyoman Ribeka</author>
		<date>August 26 2011</date>
		<description>
			Added more column on the response table
		</description>
		<sql>
			ALTER TABLE clinical_summary_medication_response ADD COLUMN review_comment VARCHAR(255) DEFAULT NULL AFTER date_reviewed;
			ALTER TABLE clinical_summary_medication_response ADD COLUMN datetime DATETIME DEFAULT NULL AFTER location;

			ALTER TABLE clinical_summary_reminder_response ADD COLUMN datetime DATETIME DEFAULT NULL AFTER location;
		</sql>
	</diff>

	<diff>
		<version>4.2.5</version>
		<author>Nyoman Ribeka</author>
		<date>August 27 2011</date>
		<description>
			Added more column on the response table
		</description>
		<sql>
			ALTER TABLE clinical_summary_medication_response DROP COLUMN medication_datetime;

			ALTER TABLE clinical_summary_reminder_response DROP COLUMN reminder_datetime;
			ALTER TABLE clinical_summary_reminder_response ADD COLUMN comment VARCHAR(512) DEFAULT NULL AFTER response;
		</sql>
	</diff>

	<diff>
		<version>4.2.6</version>
		<author>Nyoman Ribeka</author>
		<date>August 27 2011</date>
		<description>
			Added more column on the response table
		</description>
		<sql>
			ALTER TABLE clinical_summary_index ADD CONSTRAINT indexed_patient FOREIGN KEY (patient) REFERENCES patient (patient_id);
			ALTER TABLE clinical_summary_index ADD CONSTRAINT indexed_patient_location FOREIGN KEY (location) REFERENCES location (location_id);

			ALTER TABLE clinical_summary_loggable CHANGE COLUMN summary_error_id id INTEGER  NOT NULL AUTO_INCREMENT;
			ALTER TABLE clinical_summary_loggable ADD CONSTRAINT logged_patient FOREIGN KEY (patient) REFERENCES patient (patient_id);

			ALTER TABLE clinical_summary_mapping ADD CONSTRAINT mapped_summary FOREIGN KEY (summary) REFERENCES clinical_summary (id);
			ALTER TABLE clinical_summary_mapping ADD CONSTRAINT mapped_encounter_type FOREIGN KEY (encounter_type) REFERENCES encounter_type (encounter_type_id);

			ALTER TABLE clinical_summary_medication_response ADD CONSTRAINT medication_response_patient FOREIGN KEY (patient) REFERENCES patient (patient_id);
			ALTER TABLE clinical_summary_medication_response ADD CONSTRAINT medication_response_provider FOREIGN KEY (provider) REFERENCES person (person_id);
			ALTER TABLE clinical_summary_medication_response ADD CONSTRAINT medication_response_location FOREIGN KEY (location) REFERENCES location (location_id);
			ALTER TABLE clinical_summary_medication_response ADD CONSTRAINT medication_response_concept FOREIGN KEY (medication) REFERENCES concept (concept_id);
			ALTER TABLE clinical_summary_medication_response ADD CONSTRAINT medication_response_reviewer FOREIGN KEY (reviewer) REFERENCES person (person_id);
			ALTER TABLE clinical_summary_medication_response ADD CONSTRAINT medication_response_creator FOREIGN KEY (creator) REFERENCES users (user_id);

			ALTER TABLE clinical_summary_ordered_observation ADD CONSTRAINT ordered_observation_person FOREIGN KEY (person) REFERENCES person (person_id);
			ALTER TABLE clinical_summary_ordered_observation ADD CONSTRAINT ordered_observation_provider FOREIGN KEY (provider) REFERENCES person (person_id);
			ALTER TABLE clinical_summary_ordered_observation ADD CONSTRAINT ordered_observation_location FOREIGN KEY (location) REFERENCES location (location_id);
			ALTER TABLE clinical_summary_ordered_observation ADD CONSTRAINT ordered_observation_concept FOREIGN KEY (concept) REFERENCES concept (concept_id);
			ALTER TABLE clinical_summary_ordered_observation ADD CONSTRAINT ordered_observation_value_coded FOREIGN KEY (value_coded) REFERENCES concept (concept_id);
			ALTER TABLE clinical_summary_ordered_observation ADD CONSTRAINT ordered_observation_obs FOREIGN KEY (obs) REFERENCES obs (obs_id);
			ALTER TABLE clinical_summary_ordered_observation ADD CONSTRAINT ordered_observation_creator FOREIGN KEY (creator) REFERENCES users (user_id);

			ALTER TABLE clinical_summary_reminder ADD CONSTRAINT reminder_person FOREIGN KEY (patient) REFERENCES patient (patient_id);
			ALTER TABLE clinical_summary_reminder ADD CONSTRAINT reminder_provider FOREIGN KEY (provider) REFERENCES person (person_id);
			ALTER TABLE clinical_summary_reminder ADD CONSTRAINT reminder_location FOREIGN KEY (location) REFERENCES location (location_id);
			ALTER TABLE clinical_summary_reminder ADD CONSTRAINT reminder_encounter FOREIGN KEY (encounter) REFERENCES encounter (encounter_id);


			ALTER TABLE clinical_summary_reminder_response ADD CONSTRAINT reminder_response_patient FOREIGN KEY (patient) REFERENCES patient (patient_id);
			ALTER TABLE clinical_summary_reminder_response ADD CONSTRAINT reminder_response_provider FOREIGN KEY (provider) REFERENCES person (person_id);
			ALTER TABLE clinical_summary_reminder_response ADD CONSTRAINT reminder_response_location FOREIGN KEY (location) REFERENCES location (location_id);
			ALTER TABLE clinical_summary_reminder_response ADD CONSTRAINT reminder_response_creator FOREIGN KEY (creator) REFERENCES users (user_id);
		</sql>
	</diff>

	<diff>
		<version>4.2.7</version>
		<author>Nyoman Ribeka</author>
		<date>August 27 2011</date>
		<description>
			Added more column on the response table
		</description>
		<sql>
			CREATE TABLE clinical_summary_device_log (
			  id INTEGER NOT NULL AUTO_INCREMENT,
			  device_id VARCHAR(255) NOT NULL,
			  device_key VARCHAR(255) NOT NULL,
			  device_value VARCHAR(255) NOT NULL,
			  device_timestamp VARCHAR(255) NOT NULL,
			  device_user INTEGER  NOT NULL,
			  creator INTEGER  NOT NULL,
			  date_created DATETIME NOT NULL,
			  uuid varchar(38) NOT NULL,
			  PRIMARY KEY (id),
			  UNIQUE KEY uuid_clinical_summary_device_log (uuid),
			  CONSTRAINT user_who_created_device_log FOREIGN KEY (creator) REFERENCES users (user_id),
			  CONSTRAINT user_who_use_device FOREIGN KEY (device_user) REFERENCES person (person_id)
			);
		</sql>
	</diff>

</sqldiff>
